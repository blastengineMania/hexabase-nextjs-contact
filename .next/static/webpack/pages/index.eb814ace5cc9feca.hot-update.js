"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/index",{

/***/ "../../Code/Hexabase/hexabase-js/dist/lib/packages/item/index.js":
/*!***********************************************************************!*\
  !*** ../../Code/Hexabase/hexabase-js/dist/lib/packages/item/index.js ***!
  \***********************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval(__webpack_require__.ts("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nconst HxbAbstract_1 = __webpack_require__(/*! ../../../HxbAbstract */ \"../../Code/Hexabase/hexabase-js/dist/HxbAbstract.js\");\nconst item_1 = __webpack_require__(/*! ../../graphql/item */ \"../../Code/Hexabase/hexabase-js/dist/lib/graphql/item.js\");\nconst itemHistory_1 = __importDefault(__webpack_require__(/*! ../itemHistory */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/itemHistory/index.js\"));\nconst itemAction_1 = __importDefault(__webpack_require__(/*! ../itemAction */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/itemAction/index.js\"));\nconst itemStatus_1 = __importDefault(__webpack_require__(/*! ../itemStatus */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/itemStatus/index.js\"));\nconst statusAction_1 = __importDefault(__webpack_require__(/*! ../statusAction */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/statusAction/index.js\"));\nconst linkItem_1 = __importDefault(__webpack_require__(/*! ../linkItem */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/linkItem/index.js\"));\nconst fileObject_1 = __importDefault(__webpack_require__(/*! ../fileObject */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/fileObject/index.js\"));\nconst field_1 = __webpack_require__(/*! ../../../lib/types/field */ \"../../Code/Hexabase/hexabase-js/dist/lib/types/field/index.js\");\nclass Item extends HxbAbstract_1.HxbAbstract {\n    constructor() {\n        super(...arguments);\n        this.fields = {};\n        this.actions = [];\n        this.statuses = [];\n        this.statusActions = [];\n        this._existAttachment = false;\n        this._linkItems = [];\n        this._unlinkItems = [];\n        this._detail = false;\n        this.ignoreFieldUpdate = false;\n    }\n    set(key, value) {\n        switch (key) {\n            case 'datastore':\n                this.datastore = value;\n                break;\n            case 'd_id':\n                break;\n            case 'links': {\n                const project = this.datastore.project;\n                value.forEach(params => {\n                    const datasstore = project.datastoreSync(params.d_id);\n                    params.i_ids\n                        .forEach(i_id => {\n                        const linkedItem = Item.fromJson({ datastore: datasstore, i_id: i_id });\n                        this._linkItems.push(new linkItem_1.default({ item: this, linkedItem, saved: true }));\n                    });\n                });\n                break;\n            }\n            case 'item_links': {\n                if (value.item_count === 0)\n                    break;\n                const project = this.datastore.project;\n                value.links.forEach(params => {\n                    const datastore = project.datastoreSync(params.d_id);\n                    params.items.forEach(itemParams => {\n                        const linkedItem = Item.fromJson({ datastore, i_id: itemParams.i_id });\n                        this._linkItems.push(new linkItem_1.default({ item: this, linkedItem, saved: true }));\n                    });\n                });\n                break;\n            }\n            case 'pinned':\n                this.pinned = value;\n                break;\n            case 'a_id':\n            case 'p_id':\n                break;\n            case 'created_at':\n                this.createdAt = new Date(value);\n                break;\n            case 'updated_at':\n                this.updatedAt = new Date(value);\n                break;\n            case 'rev_no':\n                this.revNo = value;\n                break;\n            case 'unread':\n                this.unread = value;\n                break;\n            case 'w_id':\n                break;\n            case 'i_id':\n                if (value) {\n                    this.id = value;\n                }\n                break;\n            case 'seed_i_id':\n                this.seedItemId = value;\n                break;\n            case 'Status':\n                this.statusLabel = value;\n                break;\n            case 'status_id':\n                this.statusId = value;\n                break;\n            case 'title':\n                this.title = value;\n                break;\n            case 'created_by':\n                this.createdBy = value;\n                break;\n            case 'updated_by':\n                this.updatedBy = value;\n                break;\n            case 'lookup_items':\n                break;\n            case 'item_actions':\n                this.actions = Object.keys(value)\n                    .map((display_id) => itemAction_1.default\n                    .fromJson(Object.assign(Object.assign({ display_id }, value[display_id]), { item: this })));\n                break;\n            case 'status_list':\n                this.statuses = Object.keys(value)\n                    .map((display_id) => itemStatus_1.default\n                    .fromJson(Object.assign(Object.assign({ display_id }, value[display_id]), { item: this })));\n                break;\n            case 'status_actions':\n                this.statusActions = Object.keys(value)\n                    .map((display_id) => statusAction_1.default\n                    .fromJson(Object.assign(Object.assign({ display_id }, value[display_id]), { item: this })));\n                break;\n            case 'status_order':\n                this.statusOrder = value;\n                break;\n            case 'status_action_order':\n                this.statusActionOrder = value;\n                break;\n            case 'item_action_order':\n                this.itemActionOrder = value;\n                break;\n            case 'field_values':\n                Object.keys(value).forEach(fieldName => {\n                    const val = value[fieldName];\n                    if (val.dataType === field_1.DataType.DSLOOKUP && val.value) {\n                        const datastore = this.datastore.project.datastoreSync(val.value.d_id);\n                        const params = val.value.lookup_item;\n                        params.datastore = datastore;\n                        const item = Item.fromJson(params);\n                        this.fields[fieldName] = item;\n                    }\n                    else {\n                        this.setFieldValue(fieldName, val.value);\n                    }\n                });\n                break;\n            default:\n                this.setFieldValue(key, value);\n                break;\n        }\n        return this;\n    }\n    add(fieldName, value) {\n        if (Array.isArray(value))\n            return this.addAll(fieldName, value);\n        if (this.ignoreFieldUpdate)\n            return this;\n        const field = this.datastore.fieldSync(fieldName);\n        if (!field.valid(value)) {\n            throw new Error(`Invalid value ${value} for field key ${field.name}`);\n        }\n        if (this.fields[fieldName]) {\n            this.fields[fieldName].push(field.value(value, { item: this })[0]);\n        }\n        else {\n            this.fields[fieldName] = [field.value(value, { item: this })];\n        }\n        return this;\n    }\n    addAll(fieldName, values) {\n        values.forEach(value => this.add(fieldName, value));\n        return this;\n    }\n    setFieldValue(fieldName, value) {\n        if (this.ignoreFieldUpdate)\n            return this;\n        const field = this.datastore.fieldSync(fieldName);\n        if (!field.valid(value)) {\n            throw new Error(`Invalid value ${value} for field key ${field.name}`);\n        }\n        value = field.value(value, { item: this });\n        if (field.dataType.toLocaleLowerCase() === 'status') {\n            this._status = value;\n        }\n        this.fields[field.displayId] = value;\n        return this;\n    }\n    get(name, defaultValue) {\n        const value = this.fields[name] && this.fields[name].field ? this.fields[name].value : this.fields[name];\n        if (value === undefined || value === null && defaultValue) {\n            return defaultValue;\n        }\n        if (!value)\n            return undefined;\n        return value;\n    }\n    static all(params, datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const payload = {\n                getItemsParameters: params,\n                datastoreId: datastore.id,\n                projectId: datastore.project.id,\n            };\n            payload.getItemsParameters.return_number_value = true;\n            payload.getItemsParameters.include_links = true;\n            payload.getItemsParameters.format = 'map';\n            const res = yield Item.request(item_1.DS_ITEMS, payload);\n            for (const item of res.datastoreGetDatastoreItems.items) {\n                if (!item.item_links || !item.item_links.links || item.item_links.length === 0)\n                    continue;\n                for (const link of item.item_links.links) {\n                    if (!link.d_id)\n                        continue;\n                    const d = yield datastore.project.datastore(link.d_id);\n                    yield d.fields();\n                }\n            }\n            const items = res.datastoreGetDatastoreItems.items\n                .map((params) => Item.fromJson(Object.assign({ datastore }, params)));\n            const totalCount = res.datastoreGetDatastoreItems.totalItems;\n            return {\n                totalCount, items,\n            };\n        });\n    }\n    static search(payload, datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (typeof payload.page === 'undefined')\n                payload.page = 1;\n            if (typeof payload.per_page === 'undefined')\n                payload.per_page = 100;\n            payload.include_lookups = true;\n            payload.include_links = true;\n            payload.return_number_value = true;\n            payload.include_fields_data = true;\n            payload.format = 'map';\n            const res = yield this.request(item_1.ITEM_WITH_SEARCH, { payload });\n            return res.itemWithSearch.items.map((params) => Item.fromJson(Object.assign({ datastore }, params)));\n        });\n    }\n    static searchWithCount(payload, datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (typeof payload.page === 'undefined')\n                payload.page = 1;\n            if (typeof payload.per_page === 'undefined')\n                payload.per_page = 100;\n            payload.include_lookups = true;\n            payload.include_links = true;\n            payload.return_number_value = true;\n            payload.include_fields_data = true;\n            payload.format = 'map';\n            payload.use_display_id = true;\n            payload.datastore_id = datastore.id;\n            payload.project_id = datastore.project.id;\n            const res = yield this.request(item_1.ITEM_WITH_SEARCH, { payload });\n            console.log(res);\n            const items = res.itemWithSearch.items.map((params) => Item.fromJson(Object.assign({ datastore }, params)));\n            const totalCount = res.itemWithSearch.totalItems;\n            return {\n                totalCount, items,\n            };\n        });\n    }\n    static createItemId(datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const res = yield this.request(item_1.CREATE_ITEMID, { datastoreId: datastore.id });\n            return res.datastoreCreateItemID.item_id;\n        });\n    }\n    static delete(conditions, datasstore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const params = {\n                projectId: datasstore.project.id,\n                datastoreId: datasstore.id,\n                deleteItemsParameters: {\n                    use_display_id: true,\n                    conditions,\n                }\n            };\n            const res = yield this.request(item_1.DELETE_ITEMS, params);\n            return res.datastoreDeleteDatastoreItems.success;\n        });\n    }\n    save(comment, actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield (!this.id ? this.create(actionName) : this.update(comment, actionName));\n            yield this.fetch();\n            yield Promise.all(this._linkItems.map(linkItem => linkItem.create()));\n            yield Promise.all(this._unlinkItems.map(linkItem => linkItem.delete()));\n            this._linkItems = [];\n            this._unlinkItems = [];\n            return true;\n        });\n    }\n    link(item) {\n        this._linkItems.push(new linkItem_1.default({ item: this, linkedItem: item }));\n        return this;\n    }\n    unlink(item) {\n        this._unlinkItems.push(new linkItem_1.default({ item: this, linkedItem: item }));\n        return this;\n    }\n    create(actionName = 'CreateItem') {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.datastore)\n                throw new Error('Datastore is required');\n            const action = yield this.actionOrStatusAction(actionName);\n            const payload = {\n                action_id: action && action.id,\n                return_item_result: true,\n                is_notify_to_sender: true,\n                ensure_transaction: false,\n                exec_children_post_procs: true,\n                item: yield this.toJson(),\n            };\n            const res = yield this.request(item_1.CREATE_NEW_ITEM, {\n                projectId: this.datastore.project.id,\n                datastoreId: this.datastore.id,\n                payload,\n            });\n            if (this.datastore._fields.length === 0)\n                yield this.datastore.fields();\n            const params = {};\n            Object.keys(res.datastoreCreateNewItem.item).forEach((id) => {\n                const field = this.datastore._fields.find((f) => f.id === id || f.displayId === id);\n                if (!field) {\n                    params[id] = res.datastoreCreateNewItem.item[id];\n                }\n                else {\n                    params[field.displayId] = res.datastoreCreateNewItem.item[id];\n                }\n            });\n            for (const key in params) {\n                if (!params[key].d_id)\n                    continue;\n                const datastore = this.datastore.project.datastoreSync(params[key].d_id);\n                if (datastore) {\n                    params[key] = yield datastore.item(params[key].item_id);\n                }\n            }\n            this.sets(params);\n            this._setStatus(this._status);\n            if (this._existAttachment) {\n                yield this.update();\n                this._existAttachment = false;\n            }\n            return true;\n        });\n    }\n    execute(actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.actionOrStatusAction(actionName);\n            if (!action)\n                throw new Error(`Action ${actionName} not found`);\n            const params = {\n                rev_no: this.revNo,\n                datastore_id: this.datastore.id,\n                action_id: action && action.id,\n                is_notify_to_sender: true,\n                ensure_transaction: true,\n                exec_children_post_procs: true,\n                return_item_result: true,\n                item: yield this.toJson(),\n            };\n            const res = yield this.request(item_1.EXECUTE_ITEM_ACTION, {\n                actionId: action.id,\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                itemActionParameters: params\n            });\n            this.sets(res.datastoreExecuteItemAction.item);\n            this._setStatus(this._status);\n            return true;\n        });\n    }\n    actionOrStatusAction(actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.action(actionName);\n            if (action)\n                return action;\n            const statusAction = yield this.statusActions.find(a => a.displayId === actionName || a.id === actionName || a.name === actionName);\n            if (statusAction)\n                return statusAction;\n        });\n    }\n    update(comment, actionName = 'UpdateItem') {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.actionOrStatusAction(actionName);\n            const params = {\n                rev_no: this.revNo,\n                datastore_id: this.datastore.id,\n                action_id: action && action.id,\n                is_notify_to_sender: true,\n                ensure_transaction: true,\n                exec_children_post_procs: true,\n                return_item_result: true,\n                item: yield this.toJson(),\n            };\n            if (comment) {\n                params.history = {\n                    comment,\n                    datastore_id: this.datastore.id,\n                };\n            }\n            const res = yield this.request(item_1.DATASTORE_UPDATE_ITEM, {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                itemActionParameters: params\n            });\n            this.sets(res.datastoreUpdateItem.item);\n            this._setStatus(this._status);\n            return true;\n        });\n    }\n    toJson() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const json = {};\n            for (const key in this.fields) {\n                const field = this.datastore.fieldSync(key);\n                if (!field)\n                    throw new Error(`Field ${key} is not found`);\n                if (!this.id && field.dataType === field_1.DataType.FILE && this.fields[key] && this.fields[key].length > 0) {\n                    const files = this.fields[key];\n                    const file = files.find(f => !f.id);\n                    if (file) {\n                        this._existAttachment = true;\n                        continue;\n                    }\n                }\n                const value = yield field.convert(this.fields[key]);\n                if (typeof value !== 'undefined' && this.fields[key]) {\n                    json[key] = value;\n                }\n            }\n            return json;\n        });\n    }\n    status(status) {\n        if (status) {\n            const statusAction = this.statusActions.find(action => action.displayId === status);\n            if (!statusAction)\n                throw new Error('Status action is not found');\n            this._updateStatusAction = statusAction;\n            const newStatus = this.statuses.find(s => s.id === statusAction.nextStatusId);\n            if (!newStatus)\n                throw new Error(`Status is not found ${statusAction.nextStatusId}`);\n            this._setStatus(newStatus);\n        }\n        return this._status.displayId;\n    }\n    fetch() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const params = {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                datastoreItemDetailParams: {\n                    include_lookups: true,\n                    use_display_id: true,\n                    return_number_value: true,\n                    format: 'map',\n                    include_linked_items: true,\n                },\n            };\n            const res = yield this.request(item_1.ITEM_DETAIL, params);\n            for (const key in res.getDatastoreItemDetails.field_values) {\n                const field = res.getDatastoreItemDetails.field_values[key];\n                if (field.dataType !== 'dslookup' || !field.value)\n                    continue;\n                yield this.datastore.project.datastore(field.value.d_id);\n            }\n            this.sets(res.getDatastoreItemDetails);\n            this._setStatus(this._status);\n            return true;\n        });\n    }\n    delete() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.action('DeleteItem');\n            const params = {\n                a_id: action.id,\n            };\n            const res = yield this.request(item_1.DELETE_ITEM, {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                deleteItemReq: params,\n            });\n            return !res.datastoreDeleteItem.error;\n        });\n    }\n    action(actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.actions.length === 0) {\n                this.ignoreFieldUpdate = true;\n                yield this.fetch();\n                this.ignoreFieldUpdate = false;\n            }\n            return this.actions.find(a => a.displayId.trim().toLowerCase() === actionName.trim().toLocaleLowerCase());\n        });\n    }\n    comment() {\n        return new itemHistory_1.default({ item: this });\n    }\n    _setStatus(status) {\n        if (this.statuses.length === 0)\n            return;\n        if (typeof status === 'string') {\n            const statusName = Object.keys(this.fields).find(fieldName => this.datastore.fieldSync(fieldName).dataType === 'status');\n            if (statusName) {\n                this._status = this.statuses.find(status => status.id === this.fields[statusName]);\n            }\n            delete this.fields[statusName];\n        }\n        else {\n            this._status = status;\n        }\n    }\n    histories(getHistoryParamQueries) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const res = yield this.historiesWithUnread();\n            return res.histories;\n        });\n    }\n    historiesWithUnread(getHistoryParamQueries) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const params = {\n                projectId: this.datastore.project.id,\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                getHistoryParamQueries,\n            };\n            const res = yield this.request(item_1.ITEM_HISTORIES, params);\n            const histories = res.getHistories.histories\n                .map((history) => itemHistory_1.default.fromJson(Object.assign({ item: this }, history)));\n            return {\n                unread: res.getHistories.unread,\n                histories,\n            };\n        });\n    }\n    links(linkedDatastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const res = yield this.request(item_1.ITEM_LINKED, {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                linkedDatastoreId: typeof linkedDatastore === 'string' ? linkedDatastore : linkedDatastore.id,\n            });\n            if (res.datastoreGetLinkedItems.items.length === 0)\n                return [];\n            const projects = yield Item.client.currentWorkspace.projects();\n            const items = [];\n            for (const params of res.datastoreGetLinkedItems.items) {\n                const project = projects.find(p => p.id === params.p_id);\n                const datastore = typeof linkedDatastore === 'string' ? yield project.datastore(params.d_id) : linkedDatastore;\n                items.push(yield datastore.item(params.i_id));\n            }\n            yield Promise.all(items.map((item) => item.fetch()));\n            return items;\n        });\n    }\n    file() {\n        return new fileObject_1.default({ item: this });\n    }\n}\nexports[\"default\"] = Item;\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vQ29kZS9IZXhhYmFzZS9oZXhhYmFzZS1qcy9kaXN0L2xpYi9wYWNrYWdlcy9pdGVtL2luZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2I7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHNCQUFzQixtQkFBTyxDQUFDLGlGQUFzQjtBQUNwRCxlQUFlLG1CQUFPLENBQUMsb0ZBQW9CO0FBQzNDLHNDQUFzQyxtQkFBTyxDQUFDLDhGQUFnQjtBQUM5RCxxQ0FBcUMsbUJBQU8sQ0FBQyw0RkFBZTtBQUM1RCxxQ0FBcUMsbUJBQU8sQ0FBQyw0RkFBZTtBQUM1RCx1Q0FBdUMsbUJBQU8sQ0FBQyxnR0FBaUI7QUFDaEUsbUNBQW1DLG1CQUFPLENBQUMsd0ZBQWE7QUFDeEQscUNBQXFDLG1CQUFPLENBQUMsNEZBQWU7QUFDNUQsZ0JBQWdCLG1CQUFPLENBQUMsK0ZBQTBCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsbUNBQW1DO0FBQzlGLHNFQUFzRSxxQ0FBcUM7QUFDM0cscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsa0NBQWtDO0FBQzdGLHNFQUFzRSxxQ0FBcUM7QUFDM0cscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELFlBQVksd0JBQXdCLFlBQVk7QUFDNUc7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsWUFBWSx3QkFBd0IsWUFBWTtBQUM1RztBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxZQUFZLHdCQUF3QixZQUFZO0FBQzVHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxPQUFPLGdCQUFnQixXQUFXO0FBQy9FO0FBQ0E7QUFDQSw2REFBNkQsWUFBWTtBQUN6RTtBQUNBO0FBQ0EsMkRBQTJELFlBQVk7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLE9BQU8sZ0JBQWdCLFdBQVc7QUFDL0U7QUFDQSxxQ0FBcUMsWUFBWTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCxXQUFXO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxTQUFTO0FBQy9FLDBGQUEwRixXQUFXO0FBQ3JHLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0UsU0FBUztBQUMvRTtBQUNBLGlHQUFpRyxXQUFXO0FBQzVHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLG1FQUFtRSwyQkFBMkI7QUFDOUY7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHNEQUFzRCw4QkFBOEI7QUFDcEY7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELDhCQUE4QjtBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLFlBQVk7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsS0FBSztBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCwwQkFBMEI7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQ0FBMkMsWUFBWTtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUZBQWlGLFlBQVk7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMENBQTBDLFlBQVk7QUFDdEQ7QUFDQTtBQUNBLGtCQUFlO0FBQ2YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4uLy4uL0NvZGUvSGV4YWJhc2UvaGV4YWJhc2UtanMvZGlzdC9saWIvcGFja2FnZXMvaXRlbS9pbmRleC5qcz8wYzJmIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBIeGJBYnN0cmFjdF8xID0gcmVxdWlyZShcIi4uLy4uLy4uL0h4YkFic3RyYWN0XCIpO1xuY29uc3QgaXRlbV8xID0gcmVxdWlyZShcIi4uLy4uL2dyYXBocWwvaXRlbVwiKTtcbmNvbnN0IGl0ZW1IaXN0b3J5XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2l0ZW1IaXN0b3J5XCIpKTtcbmNvbnN0IGl0ZW1BY3Rpb25fMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vaXRlbUFjdGlvblwiKSk7XG5jb25zdCBpdGVtU3RhdHVzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2l0ZW1TdGF0dXNcIikpO1xuY29uc3Qgc3RhdHVzQWN0aW9uXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL3N0YXR1c0FjdGlvblwiKSk7XG5jb25zdCBsaW5rSXRlbV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9saW5rSXRlbVwiKSk7XG5jb25zdCBmaWxlT2JqZWN0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2ZpbGVPYmplY3RcIikpO1xuY29uc3QgZmllbGRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9saWIvdHlwZXMvZmllbGRcIik7XG5jbGFzcyBJdGVtIGV4dGVuZHMgSHhiQWJzdHJhY3RfMS5IeGJBYnN0cmFjdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMuZmllbGRzID0ge307XG4gICAgICAgIHRoaXMuYWN0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnN0YXR1c2VzID0gW107XG4gICAgICAgIHRoaXMuc3RhdHVzQWN0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLl9leGlzdEF0dGFjaG1lbnQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fbGlua0l0ZW1zID0gW107XG4gICAgICAgIHRoaXMuX3VubGlua0l0ZW1zID0gW107XG4gICAgICAgIHRoaXMuX2RldGFpbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlnbm9yZUZpZWxkVXBkYXRlID0gZmFsc2U7XG4gICAgfVxuICAgIHNldChrZXksIHZhbHVlKSB7XG4gICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlICdkYXRhc3RvcmUnOlxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YXN0b3JlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdkX2lkJzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xpbmtzJzoge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3QgPSB0aGlzLmRhdGFzdG9yZS5wcm9qZWN0O1xuICAgICAgICAgICAgICAgIHZhbHVlLmZvckVhY2gocGFyYW1zID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YXNzdG9yZSA9IHByb2plY3QuZGF0YXN0b3JlU3luYyhwYXJhbXMuZF9pZCk7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5pX2lkc1xuICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goaV9pZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5rZWRJdGVtID0gSXRlbS5mcm9tSnNvbih7IGRhdGFzdG9yZTogZGF0YXNzdG9yZSwgaV9pZDogaV9pZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpbmtJdGVtcy5wdXNoKG5ldyBsaW5rSXRlbV8xLmRlZmF1bHQoeyBpdGVtOiB0aGlzLCBsaW5rZWRJdGVtLCBzYXZlZDogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAnaXRlbV9saW5rcyc6IHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaXRlbV9jb3VudCA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdCA9IHRoaXMuZGF0YXN0b3JlLnByb2plY3Q7XG4gICAgICAgICAgICAgICAgdmFsdWUubGlua3MuZm9yRWFjaChwYXJhbXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhc3RvcmUgPSBwcm9qZWN0LmRhdGFzdG9yZVN5bmMocGFyYW1zLmRfaWQpO1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuaXRlbXMuZm9yRWFjaChpdGVtUGFyYW1zID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmtlZEl0ZW0gPSBJdGVtLmZyb21Kc29uKHsgZGF0YXN0b3JlLCBpX2lkOiBpdGVtUGFyYW1zLmlfaWQgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9saW5rSXRlbXMucHVzaChuZXcgbGlua0l0ZW1fMS5kZWZhdWx0KHsgaXRlbTogdGhpcywgbGlua2VkSXRlbSwgc2F2ZWQ6IHRydWUgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ3Bpbm5lZCc6XG4gICAgICAgICAgICAgICAgdGhpcy5waW5uZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2FfaWQnOlxuICAgICAgICAgICAgY2FzZSAncF9pZCc6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjcmVhdGVkX2F0JzpcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZWRBdCA9IG5ldyBEYXRlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZWRfYXQnOlxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlZEF0ID0gbmV3IERhdGUodmFsdWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAncmV2X25vJzpcbiAgICAgICAgICAgICAgICB0aGlzLnJldk5vID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd1bnJlYWQnOlxuICAgICAgICAgICAgICAgIHRoaXMudW5yZWFkID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd3X2lkJzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2lfaWQnOlxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc2VlZF9pX2lkJzpcbiAgICAgICAgICAgICAgICB0aGlzLnNlZWRJdGVtSWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1N0YXR1cyc6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNMYWJlbCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3RhdHVzX2lkJzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0lkID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0aXRsZSc6XG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnY3JlYXRlZF9ieSc6XG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVkQnkgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZWRfYnknOlxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlZEJ5ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsb29rdXBfaXRlbXMnOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaXRlbV9hY3Rpb25zJzpcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbnMgPSBPYmplY3Qua2V5cyh2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoZGlzcGxheV9pZCkgPT4gaXRlbUFjdGlvbl8xLmRlZmF1bHRcbiAgICAgICAgICAgICAgICAgICAgLmZyb21Kc29uKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IGRpc3BsYXlfaWQgfSwgdmFsdWVbZGlzcGxheV9pZF0pLCB7IGl0ZW06IHRoaXMgfSkpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3N0YXR1c19saXN0JzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c2VzID0gT2JqZWN0LmtleXModmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoKGRpc3BsYXlfaWQpID0+IGl0ZW1TdGF0dXNfMS5kZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgIC5mcm9tSnNvbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oeyBkaXNwbGF5X2lkIH0sIHZhbHVlW2Rpc3BsYXlfaWRdKSwgeyBpdGVtOiB0aGlzIH0pKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzdGF0dXNfYWN0aW9ucyc6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNBY3Rpb25zID0gT2JqZWN0LmtleXModmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoKGRpc3BsYXlfaWQpID0+IHN0YXR1c0FjdGlvbl8xLmRlZmF1bHRcbiAgICAgICAgICAgICAgICAgICAgLmZyb21Kc29uKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IGRpc3BsYXlfaWQgfSwgdmFsdWVbZGlzcGxheV9pZF0pLCB7IGl0ZW06IHRoaXMgfSkpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3N0YXR1c19vcmRlcic6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNPcmRlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3RhdHVzX2FjdGlvbl9vcmRlcic6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNBY3Rpb25PcmRlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaXRlbV9hY3Rpb25fb3JkZXInOlxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbUFjdGlvbk9yZGVyID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmaWVsZF92YWx1ZXMnOlxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHZhbHVlKS5mb3JFYWNoKGZpZWxkTmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHZhbHVlW2ZpZWxkTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWwuZGF0YVR5cGUgPT09IGZpZWxkXzEuRGF0YVR5cGUuRFNMT09LVVAgJiYgdmFsLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhc3RvcmUgPSB0aGlzLmRhdGFzdG9yZS5wcm9qZWN0LmRhdGFzdG9yZVN5bmModmFsLnZhbHVlLmRfaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gdmFsLnZhbHVlLmxvb2t1cF9pdGVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmRhdGFzdG9yZSA9IGRhdGFzdG9yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBJdGVtLmZyb21Kc29uKHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkc1tmaWVsZE5hbWVdID0gaXRlbTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RmllbGRWYWx1ZShmaWVsZE5hbWUsIHZhbC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGaWVsZFZhbHVlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBhZGQoZmllbGROYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRBbGwoZmllbGROYW1lLCB2YWx1ZSk7XG4gICAgICAgIGlmICh0aGlzLmlnbm9yZUZpZWxkVXBkYXRlKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy5kYXRhc3RvcmUuZmllbGRTeW5jKGZpZWxkTmFtZSk7XG4gICAgICAgIGlmICghZmllbGQudmFsaWQodmFsdWUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdmFsdWUgJHt2YWx1ZX0gZm9yIGZpZWxkIGtleSAke2ZpZWxkLm5hbWV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZmllbGRzW2ZpZWxkTmFtZV0pIHtcbiAgICAgICAgICAgIHRoaXMuZmllbGRzW2ZpZWxkTmFtZV0ucHVzaChmaWVsZC52YWx1ZSh2YWx1ZSwgeyBpdGVtOiB0aGlzIH0pWzBdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmllbGRzW2ZpZWxkTmFtZV0gPSBbZmllbGQudmFsdWUodmFsdWUsIHsgaXRlbTogdGhpcyB9KV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGFkZEFsbChmaWVsZE5hbWUsIHZhbHVlcykge1xuICAgICAgICB2YWx1ZXMuZm9yRWFjaCh2YWx1ZSA9PiB0aGlzLmFkZChmaWVsZE5hbWUsIHZhbHVlKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBzZXRGaWVsZFZhbHVlKGZpZWxkTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlRmllbGRVcGRhdGUpXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmRhdGFzdG9yZS5maWVsZFN5bmMoZmllbGROYW1lKTtcbiAgICAgICAgaWYgKCFmaWVsZC52YWxpZCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCB2YWx1ZSAke3ZhbHVlfSBmb3IgZmllbGQga2V5ICR7ZmllbGQubmFtZX1gKTtcbiAgICAgICAgfVxuICAgICAgICB2YWx1ZSA9IGZpZWxkLnZhbHVlKHZhbHVlLCB7IGl0ZW06IHRoaXMgfSk7XG4gICAgICAgIGlmIChmaWVsZC5kYXRhVHlwZS50b0xvY2FsZUxvd2VyQ2FzZSgpID09PSAnc3RhdHVzJykge1xuICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maWVsZHNbZmllbGQuZGlzcGxheUlkXSA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZ2V0KG5hbWUsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZmllbGRzW25hbWVdICYmIHRoaXMuZmllbGRzW25hbWVdLmZpZWxkID8gdGhpcy5maWVsZHNbbmFtZV0udmFsdWUgOiB0aGlzLmZpZWxkc1tuYW1lXTtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgJiYgZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdmFsdWUpXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIHN0YXRpYyBhbGwocGFyYW1zLCBkYXRhc3RvcmUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgZ2V0SXRlbXNQYXJhbWV0ZXJzOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSWQ6IGRhdGFzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IGRhdGFzdG9yZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHBheWxvYWQuZ2V0SXRlbXNQYXJhbWV0ZXJzLnJldHVybl9udW1iZXJfdmFsdWUgPSB0cnVlO1xuICAgICAgICAgICAgcGF5bG9hZC5nZXRJdGVtc1BhcmFtZXRlcnMuaW5jbHVkZV9saW5rcyA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLmdldEl0ZW1zUGFyYW1ldGVycy5mb3JtYXQgPSAnbWFwJztcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHlpZWxkIEl0ZW0ucmVxdWVzdChpdGVtXzEuRFNfSVRFTVMsIHBheWxvYWQpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHJlcy5kYXRhc3RvcmVHZXREYXRhc3RvcmVJdGVtcy5pdGVtcykge1xuICAgICAgICAgICAgICAgIGlmICghaXRlbS5pdGVtX2xpbmtzIHx8ICFpdGVtLml0ZW1fbGlua3MubGlua3MgfHwgaXRlbS5pdGVtX2xpbmtzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBsaW5rIG9mIGl0ZW0uaXRlbV9saW5rcy5saW5rcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWxpbmsuZF9pZClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0geWllbGQgZGF0YXN0b3JlLnByb2plY3QuZGF0YXN0b3JlKGxpbmsuZF9pZCk7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIGQuZmllbGRzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSByZXMuZGF0YXN0b3JlR2V0RGF0YXN0b3JlSXRlbXMuaXRlbXNcbiAgICAgICAgICAgICAgICAubWFwKChwYXJhbXMpID0+IEl0ZW0uZnJvbUpzb24oT2JqZWN0LmFzc2lnbih7IGRhdGFzdG9yZSB9LCBwYXJhbXMpKSk7XG4gICAgICAgICAgICBjb25zdCB0b3RhbENvdW50ID0gcmVzLmRhdGFzdG9yZUdldERhdGFzdG9yZUl0ZW1zLnRvdGFsSXRlbXM7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRvdGFsQ291bnQsIGl0ZW1zLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBzZWFyY2gocGF5bG9hZCwgZGF0YXN0b3JlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBheWxvYWQucGFnZSA9PT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgcGF5bG9hZC5wYWdlID0gMTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGF5bG9hZC5wZXJfcGFnZSA9PT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgcGF5bG9hZC5wZXJfcGFnZSA9IDEwMDtcbiAgICAgICAgICAgIHBheWxvYWQuaW5jbHVkZV9sb29rdXBzID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQuaW5jbHVkZV9saW5rcyA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLnJldHVybl9udW1iZXJfdmFsdWUgPSB0cnVlO1xuICAgICAgICAgICAgcGF5bG9hZC5pbmNsdWRlX2ZpZWxkc19kYXRhID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQuZm9ybWF0ID0gJ21hcCc7XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLklURU1fV0lUSF9TRUFSQ0gsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXMuaXRlbVdpdGhTZWFyY2guaXRlbXMubWFwKChwYXJhbXMpID0+IEl0ZW0uZnJvbUpzb24oT2JqZWN0LmFzc2lnbih7IGRhdGFzdG9yZSB9LCBwYXJhbXMpKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgc2VhcmNoV2l0aENvdW50KHBheWxvYWQsIGRhdGFzdG9yZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXlsb2FkLnBhZ2UgPT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIHBheWxvYWQucGFnZSA9IDE7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBheWxvYWQucGVyX3BhZ2UgPT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIHBheWxvYWQucGVyX3BhZ2UgPSAxMDA7XG4gICAgICAgICAgICBwYXlsb2FkLmluY2x1ZGVfbG9va3VwcyA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLmluY2x1ZGVfbGlua3MgPSB0cnVlO1xuICAgICAgICAgICAgcGF5bG9hZC5yZXR1cm5fbnVtYmVyX3ZhbHVlID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQuaW5jbHVkZV9maWVsZHNfZGF0YSA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLmZvcm1hdCA9ICdtYXAnO1xuICAgICAgICAgICAgcGF5bG9hZC51c2VfZGlzcGxheV9pZCA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLmRhdGFzdG9yZV9pZCA9IGRhdGFzdG9yZS5pZDtcbiAgICAgICAgICAgIHBheWxvYWQucHJvamVjdF9pZCA9IGRhdGFzdG9yZS5wcm9qZWN0LmlkO1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5JVEVNX1dJVEhfU0VBUkNILCB7IHBheWxvYWQgfSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSByZXMuaXRlbVdpdGhTZWFyY2guaXRlbXMubWFwKChwYXJhbXMpID0+IEl0ZW0uZnJvbUpzb24oT2JqZWN0LmFzc2lnbih7IGRhdGFzdG9yZSB9LCBwYXJhbXMpKSk7XG4gICAgICAgICAgICBjb25zdCB0b3RhbENvdW50ID0gcmVzLml0ZW1XaXRoU2VhcmNoLnRvdGFsSXRlbXM7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRvdGFsQ291bnQsIGl0ZW1zLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVhdGVJdGVtSWQoZGF0YXN0b3JlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLkNSRUFURV9JVEVNSUQsIHsgZGF0YXN0b3JlSWQ6IGRhdGFzdG9yZS5pZCB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXMuZGF0YXN0b3JlQ3JlYXRlSXRlbUlELml0ZW1faWQ7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgZGVsZXRlKGNvbmRpdGlvbnMsIGRhdGFzc3RvcmUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IGRhdGFzc3RvcmUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJZDogZGF0YXNzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICBkZWxldGVJdGVtc1BhcmFtZXRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlX2Rpc3BsYXlfaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHlpZWxkIHRoaXMucmVxdWVzdChpdGVtXzEuREVMRVRFX0lURU1TLCBwYXJhbXMpO1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5kYXRhc3RvcmVEZWxldGVEYXRhc3RvcmVJdGVtcy5zdWNjZXNzO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2F2ZShjb21tZW50LCBhY3Rpb25OYW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB5aWVsZCAoIXRoaXMuaWQgPyB0aGlzLmNyZWF0ZShhY3Rpb25OYW1lKSA6IHRoaXMudXBkYXRlKGNvbW1lbnQsIGFjdGlvbk5hbWUpKTtcbiAgICAgICAgICAgIHlpZWxkIHRoaXMuZmV0Y2goKTtcbiAgICAgICAgICAgIHlpZWxkIFByb21pc2UuYWxsKHRoaXMuX2xpbmtJdGVtcy5tYXAobGlua0l0ZW0gPT4gbGlua0l0ZW0uY3JlYXRlKCkpKTtcbiAgICAgICAgICAgIHlpZWxkIFByb21pc2UuYWxsKHRoaXMuX3VubGlua0l0ZW1zLm1hcChsaW5rSXRlbSA9PiBsaW5rSXRlbS5kZWxldGUoKSkpO1xuICAgICAgICAgICAgdGhpcy5fbGlua0l0ZW1zID0gW107XG4gICAgICAgICAgICB0aGlzLl91bmxpbmtJdGVtcyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBsaW5rKGl0ZW0pIHtcbiAgICAgICAgdGhpcy5fbGlua0l0ZW1zLnB1c2gobmV3IGxpbmtJdGVtXzEuZGVmYXVsdCh7IGl0ZW06IHRoaXMsIGxpbmtlZEl0ZW06IGl0ZW0gfSkpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgdW5saW5rKGl0ZW0pIHtcbiAgICAgICAgdGhpcy5fdW5saW5rSXRlbXMucHVzaChuZXcgbGlua0l0ZW1fMS5kZWZhdWx0KHsgaXRlbTogdGhpcywgbGlua2VkSXRlbTogaXRlbSB9KSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBjcmVhdGUoYWN0aW9uTmFtZSA9ICdDcmVhdGVJdGVtJykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmRhdGFzdG9yZSlcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFzdG9yZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgY29uc3QgYWN0aW9uID0geWllbGQgdGhpcy5hY3Rpb25PclN0YXR1c0FjdGlvbihhY3Rpb25OYW1lKTtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgYWN0aW9uX2lkOiBhY3Rpb24gJiYgYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgIHJldHVybl9pdGVtX3Jlc3VsdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc19ub3RpZnlfdG9fc2VuZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVuc3VyZV90cmFuc2FjdGlvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXhlY19jaGlsZHJlbl9wb3N0X3Byb2NzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGl0ZW06IHlpZWxkIHRoaXMudG9Kc29uKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5DUkVBVEVfTkVXX0lURU0sIHtcbiAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHRoaXMuZGF0YXN0b3JlLnByb2plY3QuaWQsXG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIHBheWxvYWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGFzdG9yZS5fZmllbGRzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLmRhdGFzdG9yZS5maWVsZHMoKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXMocmVzLmRhdGFzdG9yZUNyZWF0ZU5ld0l0ZW0uaXRlbSkuZm9yRWFjaCgoaWQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IHRoaXMuZGF0YXN0b3JlLl9maWVsZHMuZmluZCgoZikgPT4gZi5pZCA9PT0gaWQgfHwgZi5kaXNwbGF5SWQgPT09IGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIWZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1tpZF0gPSByZXMuZGF0YXN0b3JlQ3JlYXRlTmV3SXRlbS5pdGVtW2lkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1tmaWVsZC5kaXNwbGF5SWRdID0gcmVzLmRhdGFzdG9yZUNyZWF0ZU5ld0l0ZW0uaXRlbVtpZF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXBhcmFtc1trZXldLmRfaWQpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFzdG9yZSA9IHRoaXMuZGF0YXN0b3JlLnByb2plY3QuZGF0YXN0b3JlU3luYyhwYXJhbXNba2V5XS5kX2lkKTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YXN0b3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1trZXldID0geWllbGQgZGF0YXN0b3JlLml0ZW0ocGFyYW1zW2tleV0uaXRlbV9pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRzKHBhcmFtcyk7XG4gICAgICAgICAgICB0aGlzLl9zZXRTdGF0dXModGhpcy5fc3RhdHVzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9leGlzdEF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2V4aXN0QXR0YWNobWVudCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBleGVjdXRlKGFjdGlvbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IHlpZWxkIHRoaXMuYWN0aW9uT3JTdGF0dXNBY3Rpb24oYWN0aW9uTmFtZSk7XG4gICAgICAgICAgICBpZiAoIWFjdGlvbilcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjdGlvbiAke2FjdGlvbk5hbWV9IG5vdCBmb3VuZGApO1xuICAgICAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHJldl9ubzogdGhpcy5yZXZObyxcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVfaWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIGFjdGlvbl9pZDogYWN0aW9uICYmIGFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICBpc19ub3RpZnlfdG9fc2VuZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVuc3VyZV90cmFuc2FjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBleGVjX2NoaWxkcmVuX3Bvc3RfcHJvY3M6IHRydWUsXG4gICAgICAgICAgICAgICAgcmV0dXJuX2l0ZW1fcmVzdWx0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGl0ZW06IHlpZWxkIHRoaXMudG9Kc29uKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5FWEVDVVRFX0lURU1fQUNUSU9OLCB7XG4gICAgICAgICAgICAgICAgYWN0aW9uSWQ6IGFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJZDogdGhpcy5kYXRhc3RvcmUuaWQsXG4gICAgICAgICAgICAgICAgaXRlbUlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIHByb2plY3RJZDogdGhpcy5kYXRhc3RvcmUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICBpdGVtQWN0aW9uUGFyYW1ldGVyczogcGFyYW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuc2V0cyhyZXMuZGF0YXN0b3JlRXhlY3V0ZUl0ZW1BY3Rpb24uaXRlbSk7XG4gICAgICAgICAgICB0aGlzLl9zZXRTdGF0dXModGhpcy5fc3RhdHVzKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWN0aW9uT3JTdGF0dXNBY3Rpb24oYWN0aW9uTmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgYWN0aW9uID0geWllbGQgdGhpcy5hY3Rpb24oYWN0aW9uTmFtZSk7XG4gICAgICAgICAgICBpZiAoYWN0aW9uKVxuICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb247XG4gICAgICAgICAgICBjb25zdCBzdGF0dXNBY3Rpb24gPSB5aWVsZCB0aGlzLnN0YXR1c0FjdGlvbnMuZmluZChhID0+IGEuZGlzcGxheUlkID09PSBhY3Rpb25OYW1lIHx8IGEuaWQgPT09IGFjdGlvbk5hbWUgfHwgYS5uYW1lID09PSBhY3Rpb25OYW1lKTtcbiAgICAgICAgICAgIGlmIChzdGF0dXNBY3Rpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1c0FjdGlvbjtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHVwZGF0ZShjb21tZW50LCBhY3Rpb25OYW1lID0gJ1VwZGF0ZUl0ZW0nKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3Rpb24gPSB5aWVsZCB0aGlzLmFjdGlvbk9yU3RhdHVzQWN0aW9uKGFjdGlvbk5hbWUpO1xuICAgICAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHJldl9ubzogdGhpcy5yZXZObyxcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVfaWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIGFjdGlvbl9pZDogYWN0aW9uICYmIGFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICBpc19ub3RpZnlfdG9fc2VuZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVuc3VyZV90cmFuc2FjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBleGVjX2NoaWxkcmVuX3Bvc3RfcHJvY3M6IHRydWUsXG4gICAgICAgICAgICAgICAgcmV0dXJuX2l0ZW1fcmVzdWx0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGl0ZW06IHlpZWxkIHRoaXMudG9Kc29uKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKGNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMuaGlzdG9yeSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29tbWVudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YXN0b3JlX2lkOiB0aGlzLmRhdGFzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5EQVRBU1RPUkVfVVBEQVRFX0lURU0sIHtcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJZDogdGhpcy5kYXRhc3RvcmUuaWQsXG4gICAgICAgICAgICAgICAgaXRlbUlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIHByb2plY3RJZDogdGhpcy5kYXRhc3RvcmUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICBpdGVtQWN0aW9uUGFyYW1ldGVyczogcGFyYW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuc2V0cyhyZXMuZGF0YXN0b3JlVXBkYXRlSXRlbS5pdGVtKTtcbiAgICAgICAgICAgIHRoaXMuX3NldFN0YXR1cyh0aGlzLl9zdGF0dXMpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB0b0pzb24oKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBqc29uID0ge307XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLmZpZWxkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy5kYXRhc3RvcmUuZmllbGRTeW5jKGtleSk7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWVsZClcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWVsZCAke2tleX0gaXMgbm90IGZvdW5kYCk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlkICYmIGZpZWxkLmRhdGFUeXBlID09PSBmaWVsZF8xLkRhdGFUeXBlLkZJTEUgJiYgdGhpcy5maWVsZHNba2V5XSAmJiB0aGlzLmZpZWxkc1trZXldLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmZpZWxkc1trZXldO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXMuZmluZChmID0+ICFmLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2V4aXN0QXR0YWNobWVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHlpZWxkIGZpZWxkLmNvbnZlcnQodGhpcy5maWVsZHNba2V5XSk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdGhpcy5maWVsZHNba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBqc29uW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ganNvbjtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXR1cyhzdGF0dXMpIHtcbiAgICAgICAgaWYgKHN0YXR1cykge1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzQWN0aW9uID0gdGhpcy5zdGF0dXNBY3Rpb25zLmZpbmQoYWN0aW9uID0+IGFjdGlvbi5kaXNwbGF5SWQgPT09IHN0YXR1cyk7XG4gICAgICAgICAgICBpZiAoIXN0YXR1c0FjdGlvbilcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0YXR1cyBhY3Rpb24gaXMgbm90IGZvdW5kJyk7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVTdGF0dXNBY3Rpb24gPSBzdGF0dXNBY3Rpb247XG4gICAgICAgICAgICBjb25zdCBuZXdTdGF0dXMgPSB0aGlzLnN0YXR1c2VzLmZpbmQocyA9PiBzLmlkID09PSBzdGF0dXNBY3Rpb24ubmV4dFN0YXR1c0lkKTtcbiAgICAgICAgICAgIGlmICghbmV3U3RhdHVzKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgU3RhdHVzIGlzIG5vdCBmb3VuZCAke3N0YXR1c0FjdGlvbi5uZXh0U3RhdHVzSWR9YCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRTdGF0dXMobmV3U3RhdHVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdHVzLmRpc3BsYXlJZDtcbiAgICB9XG4gICAgZmV0Y2goKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIGl0ZW1JZDogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHRoaXMuZGF0YXN0b3JlLnByb2plY3QuaWQsXG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSXRlbURldGFpbFBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlX2xvb2t1cHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZV9kaXNwbGF5X2lkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZXR1cm5fbnVtYmVyX3ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6ICdtYXAnLFxuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlX2xpbmtlZF9pdGVtczogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHlpZWxkIHRoaXMucmVxdWVzdChpdGVtXzEuSVRFTV9ERVRBSUwsIHBhcmFtcyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiByZXMuZ2V0RGF0YXN0b3JlSXRlbURldGFpbHMuZmllbGRfdmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSByZXMuZ2V0RGF0YXN0b3JlSXRlbURldGFpbHMuZmllbGRfdmFsdWVzW2tleV07XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLmRhdGFUeXBlICE9PSAnZHNsb29rdXAnIHx8ICFmaWVsZC52YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy5kYXRhc3RvcmUucHJvamVjdC5kYXRhc3RvcmUoZmllbGQudmFsdWUuZF9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNldHMocmVzLmdldERhdGFzdG9yZUl0ZW1EZXRhaWxzKTtcbiAgICAgICAgICAgIHRoaXMuX3NldFN0YXR1cyh0aGlzLl9zdGF0dXMpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBkZWxldGUoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3Rpb24gPSB5aWVsZCB0aGlzLmFjdGlvbignRGVsZXRlSXRlbScpO1xuICAgICAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIGFfaWQ6IGFjdGlvbi5pZCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLkRFTEVURV9JVEVNLCB7XG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIGl0ZW1JZDogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHRoaXMuZGF0YXN0b3JlLnByb2plY3QuaWQsXG4gICAgICAgICAgICAgICAgZGVsZXRlSXRlbVJlcTogcGFyYW1zLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gIXJlcy5kYXRhc3RvcmVEZWxldGVJdGVtLmVycm9yO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWN0aW9uKGFjdGlvbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFjdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVGaWVsZFVwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy5mZXRjaCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWdub3JlRmllbGRVcGRhdGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjdGlvbnMuZmluZChhID0+IGEuZGlzcGxheUlkLnRyaW0oKS50b0xvd2VyQ2FzZSgpID09PSBhY3Rpb25OYW1lLnRyaW0oKS50b0xvY2FsZUxvd2VyQ2FzZSgpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbW1lbnQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgaXRlbUhpc3RvcnlfMS5kZWZhdWx0KHsgaXRlbTogdGhpcyB9KTtcbiAgICB9XG4gICAgX3NldFN0YXR1cyhzdGF0dXMpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdHVzZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodHlwZW9mIHN0YXR1cyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXR1c05hbWUgPSBPYmplY3Qua2V5cyh0aGlzLmZpZWxkcykuZmluZChmaWVsZE5hbWUgPT4gdGhpcy5kYXRhc3RvcmUuZmllbGRTeW5jKGZpZWxkTmFtZSkuZGF0YVR5cGUgPT09ICdzdGF0dXMnKTtcbiAgICAgICAgICAgIGlmIChzdGF0dXNOYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gdGhpcy5zdGF0dXNlcy5maW5kKHN0YXR1cyA9PiBzdGF0dXMuaWQgPT09IHRoaXMuZmllbGRzW3N0YXR1c05hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmZpZWxkc1tzdGF0dXNOYW1lXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgfVxuICAgIH1cbiAgICBoaXN0b3JpZXMoZ2V0SGlzdG9yeVBhcmFtUXVlcmllcykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5oaXN0b3JpZXNXaXRoVW5yZWFkKCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzLmhpc3RvcmllcztcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhpc3Rvcmllc1dpdGhVbnJlYWQoZ2V0SGlzdG9yeVBhcmFtUXVlcmllcykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHByb2plY3RJZDogdGhpcy5kYXRhc3RvcmUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJZDogdGhpcy5kYXRhc3RvcmUuaWQsXG4gICAgICAgICAgICAgICAgaXRlbUlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIGdldEhpc3RvcnlQYXJhbVF1ZXJpZXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5JVEVNX0hJU1RPUklFUywgcGFyYW1zKTtcbiAgICAgICAgICAgIGNvbnN0IGhpc3RvcmllcyA9IHJlcy5nZXRIaXN0b3JpZXMuaGlzdG9yaWVzXG4gICAgICAgICAgICAgICAgLm1hcCgoaGlzdG9yeSkgPT4gaXRlbUhpc3RvcnlfMS5kZWZhdWx0LmZyb21Kc29uKE9iamVjdC5hc3NpZ24oeyBpdGVtOiB0aGlzIH0sIGhpc3RvcnkpKSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVucmVhZDogcmVzLmdldEhpc3Rvcmllcy51bnJlYWQsXG4gICAgICAgICAgICAgICAgaGlzdG9yaWVzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGxpbmtzKGxpbmtlZERhdGFzdG9yZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5JVEVNX0xJTktFRCwge1xuICAgICAgICAgICAgICAgIGRhdGFzdG9yZUlkOiB0aGlzLmRhdGFzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICBpdGVtSWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgbGlua2VkRGF0YXN0b3JlSWQ6IHR5cGVvZiBsaW5rZWREYXRhc3RvcmUgPT09ICdzdHJpbmcnID8gbGlua2VkRGF0YXN0b3JlIDogbGlua2VkRGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAocmVzLmRhdGFzdG9yZUdldExpbmtlZEl0ZW1zLml0ZW1zLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICBjb25zdCBwcm9qZWN0cyA9IHlpZWxkIEl0ZW0uY2xpZW50LmN1cnJlbnRXb3Jrc3BhY2UucHJvamVjdHMoKTtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBhcmFtcyBvZiByZXMuZGF0YXN0b3JlR2V0TGlua2VkSXRlbXMuaXRlbXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0ID0gcHJvamVjdHMuZmluZChwID0+IHAuaWQgPT09IHBhcmFtcy5wX2lkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhc3RvcmUgPSB0eXBlb2YgbGlua2VkRGF0YXN0b3JlID09PSAnc3RyaW5nJyA/IHlpZWxkIHByb2plY3QuZGF0YXN0b3JlKHBhcmFtcy5kX2lkKSA6IGxpbmtlZERhdGFzdG9yZTtcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHlpZWxkIGRhdGFzdG9yZS5pdGVtKHBhcmFtcy5pX2lkKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB5aWVsZCBQcm9taXNlLmFsbChpdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uZmV0Y2goKSkpO1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZmlsZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBmaWxlT2JqZWN0XzEuZGVmYXVsdCh7IGl0ZW06IHRoaXMgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5kZWZhdWx0ID0gSXRlbTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../../Code/Hexabase/hexabase-js/dist/lib/packages/item/index.js\n"));

/***/ })

});