"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/index",{

/***/ "../../Code/Hexabase/hexabase-js/dist/lib/packages/item/index.js":
/*!***********************************************************************!*\
  !*** ../../Code/Hexabase/hexabase-js/dist/lib/packages/item/index.js ***!
  \***********************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval(__webpack_require__.ts("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nconst HxbAbstract_1 = __webpack_require__(/*! ../../../HxbAbstract */ \"../../Code/Hexabase/hexabase-js/dist/HxbAbstract.js\");\nconst item_1 = __webpack_require__(/*! ../../graphql/item */ \"../../Code/Hexabase/hexabase-js/dist/lib/graphql/item.js\");\nconst itemHistory_1 = __importDefault(__webpack_require__(/*! ../itemHistory */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/itemHistory/index.js\"));\nconst itemAction_1 = __importDefault(__webpack_require__(/*! ../itemAction */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/itemAction/index.js\"));\nconst itemStatus_1 = __importDefault(__webpack_require__(/*! ../itemStatus */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/itemStatus/index.js\"));\nconst statusAction_1 = __importDefault(__webpack_require__(/*! ../statusAction */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/statusAction/index.js\"));\nconst linkItem_1 = __importDefault(__webpack_require__(/*! ../linkItem */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/linkItem/index.js\"));\nconst fileObject_1 = __importDefault(__webpack_require__(/*! ../fileObject */ \"../../Code/Hexabase/hexabase-js/dist/lib/packages/fileObject/index.js\"));\nconst field_1 = __webpack_require__(/*! ../../../lib/types/field */ \"../../Code/Hexabase/hexabase-js/dist/lib/types/field/index.js\");\nclass Item extends HxbAbstract_1.HxbAbstract {\n    constructor() {\n        super(...arguments);\n        this.fields = {};\n        this.actions = [];\n        this.statuses = [];\n        this.statusActions = [];\n        this._existAttachment = false;\n        this._linkItems = [];\n        this._unlinkItems = [];\n        this._detail = false;\n        this.ignoreFieldUpdate = false;\n    }\n    set(key, value) {\n        switch (key) {\n            case 'datastore':\n                this.datastore = value;\n                break;\n            case 'd_id':\n                break;\n            case 'links': {\n                const project = this.datastore.project;\n                value.forEach(params => {\n                    const datasstore = project.datastoreSync(params.d_id);\n                    params.i_ids\n                        .forEach(i_id => {\n                        const linkedItem = Item.fromJson({ datastore: datasstore, i_id: i_id });\n                        this._linkItems.push(new linkItem_1.default({ item: this, linkedItem, saved: true }));\n                    });\n                });\n                break;\n            }\n            case 'item_links': {\n                if (value.item_count === 0)\n                    break;\n                const project = this.datastore.project;\n                value.links.forEach(params => {\n                    const datastore = project.datastoreSync(params.d_id);\n                    params.items.forEach(itemParams => {\n                        const linkedItem = Item.fromJson({ datastore, i_id: itemParams.i_id });\n                        this._linkItems.push(new linkItem_1.default({ item: this, linkedItem, saved: true }));\n                    });\n                });\n                break;\n            }\n            case 'pinned':\n                this.pinned = value;\n                break;\n            case 'a_id':\n            case 'p_id':\n                break;\n            case 'created_at':\n                this.createdAt = new Date(value);\n                break;\n            case 'updated_at':\n                this.updatedAt = new Date(value);\n                break;\n            case 'rev_no':\n                this.revNo = value;\n                break;\n            case 'unread':\n                this.unread = value;\n                break;\n            case 'w_id':\n                break;\n            case 'i_id':\n                if (value) {\n                    this.id = value;\n                }\n                break;\n            case 'seed_i_id':\n                this.seedItemId = value;\n                break;\n            case 'Status':\n                this.statusLabel = value;\n                break;\n            case 'status_id':\n                this.statusId = value;\n                break;\n            case 'title':\n                this.title = value;\n                break;\n            case 'created_by':\n                this.createdBy = value;\n                break;\n            case 'updated_by':\n                this.updatedBy = value;\n                break;\n            case 'lookup_items':\n                break;\n            case 'item_actions':\n                this.actions = Object.keys(value)\n                    .map((display_id) => itemAction_1.default\n                    .fromJson(Object.assign(Object.assign({ display_id }, value[display_id]), { item: this })));\n                break;\n            case 'status_list':\n                this.statuses = Object.keys(value)\n                    .map((display_id) => itemStatus_1.default\n                    .fromJson(Object.assign(Object.assign({ display_id }, value[display_id]), { item: this })));\n                break;\n            case 'status_actions':\n                this.statusActions = Object.keys(value)\n                    .map((display_id) => statusAction_1.default\n                    .fromJson(Object.assign(Object.assign({ display_id }, value[display_id]), { item: this })));\n                break;\n            case 'status_order':\n                this.statusOrder = value;\n                break;\n            case 'status_action_order':\n                this.statusActionOrder = value;\n                break;\n            case 'item_action_order':\n                this.itemActionOrder = value;\n                break;\n            case 'field_values':\n                Object.keys(value).forEach(fieldName => {\n                    const val = value[fieldName];\n                    if (val.dataType === field_1.DataType.DSLOOKUP && val.value) {\n                        const datastore = this.datastore.project.datastoreSync(val.value.d_id);\n                        const params = val.value.lookup_item;\n                        params.datastore = datastore;\n                        const item = Item.fromJson(params);\n                        this.fields[fieldName] = item;\n                    }\n                    else {\n                        this.setFieldValue(fieldName, val.value);\n                    }\n                });\n                break;\n            default:\n                this.setFieldValue(key, value);\n                break;\n        }\n        return this;\n    }\n    add(fieldName, value) {\n        if (Array.isArray(value))\n            return this.addAll(fieldName, value);\n        if (this.ignoreFieldUpdate)\n            return this;\n        const field = this.datastore.fieldSync(fieldName);\n        if (!field.valid(value)) {\n            throw new Error(`Invalid value ${value} for field key ${field.name}`);\n        }\n        if (this.fields[fieldName]) {\n            this.fields[fieldName].push(field.value(value, { item: this })[0]);\n        }\n        else {\n            this.fields[fieldName] = [field.value(value, { item: this })];\n        }\n        return this;\n    }\n    addAll(fieldName, values) {\n        values.forEach(value => this.add(fieldName, value));\n        return this;\n    }\n    setFieldValue(fieldName, value) {\n        if (this.ignoreFieldUpdate)\n            return this;\n        const field = this.datastore.fieldSync(fieldName);\n        if (!field.valid(value)) {\n            throw new Error(`Invalid value ${value} for field key ${field.name}`);\n        }\n        value = field.value(value, { item: this });\n        if (field.dataType.toLocaleLowerCase() === 'status') {\n            this._status = value;\n        }\n        this.fields[field.displayId] = value;\n        return this;\n    }\n    get(name, defaultValue) {\n        const value = this.fields[name] && this.fields[name].field ? this.fields[name].value : this.fields[name];\n        if (value === undefined || value === null && defaultValue) {\n            return defaultValue;\n        }\n        if (!value)\n            return undefined;\n        return value;\n    }\n    static all(params, datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const payload = {\n                getItemsParameters: params,\n                datastoreId: datastore.id,\n                projectId: datastore.project.id,\n            };\n            payload.getItemsParameters.return_number_value = true;\n            payload.getItemsParameters.include_links = true;\n            payload.getItemsParameters.format = 'map';\n            const res = yield Item.request(item_1.DS_ITEMS, payload);\n            for (const item of res.datastoreGetDatastoreItems.items) {\n                if (!item.item_links || !item.item_links.links || item.item_links.length === 0)\n                    continue;\n                for (const link of item.item_links.links) {\n                    if (!link.d_id)\n                        continue;\n                    const d = yield datastore.project.datastore(link.d_id);\n                    yield d.fields();\n                }\n            }\n            const items = res.datastoreGetDatastoreItems.items\n                .map((params) => Item.fromJson(Object.assign({ datastore }, params)));\n            const totalCount = res.datastoreGetDatastoreItems.totalItems;\n            return {\n                totalCount, items,\n            };\n        });\n    }\n    static search(payload, datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (typeof payload.page === 'undefined')\n                payload.page = 1;\n            if (typeof payload.per_page === 'undefined')\n                payload.per_page = 100;\n            payload.include_lookups = true;\n            payload.include_links = true;\n            payload.return_number_value = true;\n            payload.include_fields_data = true;\n            payload.format = 'map';\n            const res = yield this.request(item_1.ITEM_WITH_SEARCH, { payload });\n            return res.itemWithSearch.items.map((params) => Item.fromJson(Object.assign({ datastore }, params)));\n        });\n    }\n    static searchWithCount(payload, datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (typeof payload.page === 'undefined')\n                payload.page = 1;\n            if (typeof payload.per_page === 'undefined')\n                payload.per_page = 100;\n            payload.include_lookups = true;\n            payload.include_links = true;\n            payload.return_number_value = true;\n            payload.include_fields_data = true;\n            payload.format = 'map';\n            payload.use_display_id = true;\n            payload.datastore_id = datastore.id;\n            payload.project_id = datastore.project.id;\n            const res = yield this.request(item_1.ITEM_WITH_SEARCH, { payload });\n            const items = res.itemWithSearch.items.map((params) => Item.fromJson(Object.assign({ datastore }, params)));\n            const totalCount = res.itemWithSearch.totalItems;\n            return {\n                totalCount, items,\n            };\n        });\n    }\n    static createItemId(datastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const res = yield this.request(item_1.CREATE_ITEMID, { datastoreId: datastore.id });\n            return res.datastoreCreateItemID.item_id;\n        });\n    }\n    static delete(conditions, datasstore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const params = {\n                projectId: datasstore.project.id,\n                datastoreId: datasstore.id,\n                deleteItemsParameters: {\n                    use_display_id: true,\n                    conditions,\n                }\n            };\n            const res = yield this.request(item_1.DELETE_ITEMS, params);\n            return res.datastoreDeleteDatastoreItems.success;\n        });\n    }\n    save(comment, actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield (!this.id ? this.create(actionName) : this.update(comment, actionName));\n            yield this.fetch();\n            yield Promise.all(this._linkItems.map(linkItem => linkItem.create()));\n            yield Promise.all(this._unlinkItems.map(linkItem => linkItem.delete()));\n            this._linkItems = [];\n            this._unlinkItems = [];\n            return true;\n        });\n    }\n    link(item) {\n        this._linkItems.push(new linkItem_1.default({ item: this, linkedItem: item }));\n        return this;\n    }\n    unlink(item) {\n        this._unlinkItems.push(new linkItem_1.default({ item: this, linkedItem: item }));\n        return this;\n    }\n    create(actionName = 'CreateItem') {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.datastore)\n                throw new Error('Datastore is required');\n            const action = yield this.actionOrStatusAction(actionName);\n            const payload = {\n                action_id: action && action.id,\n                return_item_result: true,\n                is_notify_to_sender: true,\n                ensure_transaction: false,\n                exec_children_post_procs: true,\n                item: yield this.toJson(),\n            };\n            const res = yield this.request(item_1.CREATE_NEW_ITEM, {\n                projectId: this.datastore.project.id,\n                datastoreId: this.datastore.id,\n                payload,\n            });\n            if (this.datastore._fields.length === 0)\n                yield this.datastore.fields();\n            const params = {};\n            Object.keys(res.datastoreCreateNewItem.item).forEach((id) => {\n                const field = this.datastore._fields.find((f) => f.id === id || f.displayId === id);\n                if (!field) {\n                    params[id] = res.datastoreCreateNewItem.item[id];\n                }\n                else {\n                    params[field.displayId] = res.datastoreCreateNewItem.item[id];\n                }\n            });\n            for (const key in params) {\n                if (!params[key].d_id)\n                    continue;\n                const datastore = this.datastore.project.datastoreSync(params[key].d_id);\n                if (datastore) {\n                    params[key] = yield datastore.item(params[key].item_id);\n                }\n            }\n            this.sets(params);\n            this._setStatus(this._status);\n            if (this._existAttachment) {\n                yield this.update();\n                this._existAttachment = false;\n            }\n            return true;\n        });\n    }\n    execute(actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.actionOrStatusAction(actionName);\n            if (!action)\n                throw new Error(`Action ${actionName} not found`);\n            const params = {\n                rev_no: this.revNo,\n                datastore_id: this.datastore.id,\n                action_id: action && action.id,\n                is_notify_to_sender: true,\n                ensure_transaction: true,\n                exec_children_post_procs: true,\n                return_item_result: true,\n                item: yield this.toJson(),\n            };\n            const res = yield this.request(item_1.EXECUTE_ITEM_ACTION, {\n                actionId: action.id,\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                itemActionParameters: params\n            });\n            this.sets(res.datastoreExecuteItemAction.item);\n            this._setStatus(this._status);\n            return true;\n        });\n    }\n    actionOrStatusAction(actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.action(actionName);\n            if (action)\n                return action;\n            const statusAction = this.statusActions.find(a => a.displayId === actionName || a.id === actionName || a.name === actionName);\n            return statusAction;\n        });\n    }\n    update(comment, actionName = 'UpdateItem') {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.actionOrStatusAction(actionName);\n            const params = {\n                rev_no: this.revNo,\n                datastore_id: this.datastore.id,\n                action_id: action && action.id,\n                is_notify_to_sender: true,\n                ensure_transaction: true,\n                exec_children_post_procs: true,\n                return_item_result: true,\n                item: yield this.toJson(),\n            };\n            if (comment) {\n                params.history = {\n                    comment,\n                    datastore_id: this.datastore.id,\n                };\n            }\n            const res = yield this.request(item_1.DATASTORE_UPDATE_ITEM, {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                itemActionParameters: params\n            });\n            this.sets(res.datastoreUpdateItem.item);\n            this._setStatus(this._status);\n            return true;\n        });\n    }\n    toJson() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const json = {};\n            for (const key in this.fields) {\n                const field = this.datastore.fieldSync(key);\n                if (!field)\n                    throw new Error(`Field ${key} is not found`);\n                if (!this.id && field.dataType === field_1.DataType.FILE && this.fields[key] && this.fields[key].length > 0) {\n                    const files = this.fields[key];\n                    const file = files.find(f => !f.id);\n                    if (file) {\n                        this._existAttachment = true;\n                        continue;\n                    }\n                }\n                const value = yield field.convert(this.fields[key]);\n                if (typeof value !== 'undefined' && this.fields[key]) {\n                    json[key] = value;\n                }\n            }\n            return json;\n        });\n    }\n    status(status) {\n        if (status) {\n            const statusAction = this.statusActions.find(action => action.displayId === status);\n            if (!statusAction)\n                throw new Error('Status action is not found');\n            this._updateStatusAction = statusAction;\n            const newStatus = this.statuses.find(s => s.id === statusAction.nextStatusId);\n            if (!newStatus)\n                throw new Error(`Status is not found ${statusAction.nextStatusId}`);\n            this._setStatus(newStatus);\n        }\n        return this._status.displayId;\n    }\n    fetch() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const params = {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                datastoreItemDetailParams: {\n                    include_lookups: true,\n                    use_display_id: true,\n                    return_number_value: true,\n                    format: 'map',\n                    include_linked_items: true,\n                },\n            };\n            const res = yield this.request(item_1.ITEM_DETAIL, params);\n            for (const key in res.getDatastoreItemDetails.field_values) {\n                const field = res.getDatastoreItemDetails.field_values[key];\n                if (field.dataType !== 'dslookup' || !field.value)\n                    continue;\n                yield this.datastore.project.datastore(field.value.d_id);\n            }\n            this.sets(res.getDatastoreItemDetails);\n            this._setStatus(this._status);\n            return true;\n        });\n    }\n    delete() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const action = yield this.action('DeleteItem');\n            const params = {\n                a_id: action.id,\n            };\n            const res = yield this.request(item_1.DELETE_ITEM, {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                projectId: this.datastore.project.id,\n                deleteItemReq: params,\n            });\n            return !res.datastoreDeleteItem.error;\n        });\n    }\n    action(actionName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.actions.length === 0) {\n                this.ignoreFieldUpdate = true;\n                yield this.fetch();\n                this.ignoreFieldUpdate = false;\n            }\n            return this.actions.find(a => a.displayId.trim().toLowerCase() === actionName.trim().toLocaleLowerCase());\n        });\n    }\n    comment() {\n        return new itemHistory_1.default({ item: this });\n    }\n    _setStatus(status) {\n        if (this.statuses.length === 0)\n            return;\n        if (typeof status === 'string') {\n            const statusName = Object.keys(this.fields).find(fieldName => this.datastore.fieldSync(fieldName).dataType === 'status');\n            if (statusName) {\n                this._status = this.statuses.find(status => status.id === this.fields[statusName]);\n            }\n            delete this.fields[statusName];\n        }\n        else {\n            this._status = status;\n        }\n    }\n    histories(getHistoryParamQueries) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const res = yield this.historiesWithUnread();\n            return res.histories;\n        });\n    }\n    historiesWithUnread(getHistoryParamQueries) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const params = {\n                projectId: this.datastore.project.id,\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                getHistoryParamQueries,\n            };\n            const res = yield this.request(item_1.ITEM_HISTORIES, params);\n            const histories = res.getHistories.histories\n                .map((history) => itemHistory_1.default.fromJson(Object.assign({ item: this }, history)));\n            return {\n                unread: res.getHistories.unread,\n                histories,\n            };\n        });\n    }\n    links(linkedDatastore) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const res = yield this.request(item_1.ITEM_LINKED, {\n                datastoreId: this.datastore.id,\n                itemId: this.id,\n                linkedDatastoreId: typeof linkedDatastore === 'string' ? linkedDatastore : linkedDatastore.id,\n            });\n            if (res.datastoreGetLinkedItems.items.length === 0)\n                return [];\n            const projects = yield Item.client.currentWorkspace.projects();\n            const items = [];\n            for (const params of res.datastoreGetLinkedItems.items) {\n                const project = projects.find(p => p.id === params.p_id);\n                const datastore = typeof linkedDatastore === 'string' ? yield project.datastore(params.d_id) : linkedDatastore;\n                items.push(yield datastore.item(params.i_id));\n            }\n            yield Promise.all(items.map((item) => item.fetch()));\n            return items;\n        });\n    }\n    file() {\n        return new fileObject_1.default({ item: this });\n    }\n}\nexports[\"default\"] = Item;\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vQ29kZS9IZXhhYmFzZS9oZXhhYmFzZS1qcy9kaXN0L2xpYi9wYWNrYWdlcy9pdGVtL2luZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2I7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHNCQUFzQixtQkFBTyxDQUFDLGlGQUFzQjtBQUNwRCxlQUFlLG1CQUFPLENBQUMsb0ZBQW9CO0FBQzNDLHNDQUFzQyxtQkFBTyxDQUFDLDhGQUFnQjtBQUM5RCxxQ0FBcUMsbUJBQU8sQ0FBQyw0RkFBZTtBQUM1RCxxQ0FBcUMsbUJBQU8sQ0FBQyw0RkFBZTtBQUM1RCx1Q0FBdUMsbUJBQU8sQ0FBQyxnR0FBaUI7QUFDaEUsbUNBQW1DLG1CQUFPLENBQUMsd0ZBQWE7QUFDeEQscUNBQXFDLG1CQUFPLENBQUMsNEZBQWU7QUFDNUQsZ0JBQWdCLG1CQUFPLENBQUMsK0ZBQTBCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsbUNBQW1DO0FBQzlGLHNFQUFzRSxxQ0FBcUM7QUFDM0cscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsa0NBQWtDO0FBQzdGLHNFQUFzRSxxQ0FBcUM7QUFDM0cscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELFlBQVksd0JBQXdCLFlBQVk7QUFDNUc7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsWUFBWSx3QkFBd0IsWUFBWTtBQUM1RztBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxZQUFZLHdCQUF3QixZQUFZO0FBQzVHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxPQUFPLGdCQUFnQixXQUFXO0FBQy9FO0FBQ0E7QUFDQSw2REFBNkQsWUFBWTtBQUN6RTtBQUNBO0FBQ0EsMkRBQTJELFlBQVk7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLE9BQU8sZ0JBQWdCLFdBQVc7QUFDL0U7QUFDQSxxQ0FBcUMsWUFBWTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCxXQUFXO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxTQUFTO0FBQy9FLDBGQUEwRixXQUFXO0FBQ3JHLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0UsU0FBUztBQUMvRSxpR0FBaUcsV0FBVztBQUM1RztBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxtRUFBbUUsMkJBQTJCO0FBQzlGO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxzREFBc0QsOEJBQThCO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCw4QkFBOEI7QUFDdEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxZQUFZO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxLQUFLO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELDBCQUEwQjtBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLDJDQUEyQyxZQUFZO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsWUFBWTtBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwwQ0FBMEMsWUFBWTtBQUN0RDtBQUNBO0FBQ0Esa0JBQWU7QUFDZiIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi4vLi4vQ29kZS9IZXhhYmFzZS9oZXhhYmFzZS1qcy9kaXN0L2xpYi9wYWNrYWdlcy9pdGVtL2luZGV4LmpzPzBjMmYiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEh4YkFic3RyYWN0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vSHhiQWJzdHJhY3RcIik7XG5jb25zdCBpdGVtXzEgPSByZXF1aXJlKFwiLi4vLi4vZ3JhcGhxbC9pdGVtXCIpO1xuY29uc3QgaXRlbUhpc3RvcnlfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vaXRlbUhpc3RvcnlcIikpO1xuY29uc3QgaXRlbUFjdGlvbl8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9pdGVtQWN0aW9uXCIpKTtcbmNvbnN0IGl0ZW1TdGF0dXNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vaXRlbVN0YXR1c1wiKSk7XG5jb25zdCBzdGF0dXNBY3Rpb25fMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vc3RhdHVzQWN0aW9uXCIpKTtcbmNvbnN0IGxpbmtJdGVtXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2xpbmtJdGVtXCIpKTtcbmNvbnN0IGZpbGVPYmplY3RfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vZmlsZU9iamVjdFwiKSk7XG5jb25zdCBmaWVsZF8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2xpYi90eXBlcy9maWVsZFwiKTtcbmNsYXNzIEl0ZW0gZXh0ZW5kcyBIeGJBYnN0cmFjdF8xLkh4YkFic3RyYWN0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy5maWVsZHMgPSB7fTtcbiAgICAgICAgdGhpcy5hY3Rpb25zID0gW107XG4gICAgICAgIHRoaXMuc3RhdHVzZXMgPSBbXTtcbiAgICAgICAgdGhpcy5zdGF0dXNBY3Rpb25zID0gW107XG4gICAgICAgIHRoaXMuX2V4aXN0QXR0YWNobWVudCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9saW5rSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5fdW5saW5rSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5fZGV0YWlsID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaWdub3JlRmllbGRVcGRhdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgc2V0KGtleSwgdmFsdWUpIHtcbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgJ2RhdGFzdG9yZSc6XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhc3RvcmUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2RfaWQnOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbGlua3MnOiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdCA9IHRoaXMuZGF0YXN0b3JlLnByb2plY3Q7XG4gICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChwYXJhbXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhc3N0b3JlID0gcHJvamVjdC5kYXRhc3RvcmVTeW5jKHBhcmFtcy5kX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmlfaWRzXG4gICAgICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaChpX2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmtlZEl0ZW0gPSBJdGVtLmZyb21Kc29uKHsgZGF0YXN0b3JlOiBkYXRhc3N0b3JlLCBpX2lkOiBpX2lkIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGlua0l0ZW1zLnB1c2gobmV3IGxpbmtJdGVtXzEuZGVmYXVsdCh7IGl0ZW06IHRoaXMsIGxpbmtlZEl0ZW0sIHNhdmVkOiB0cnVlIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdpdGVtX2xpbmtzJzoge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pdGVtX2NvdW50ID09PSAwKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0ID0gdGhpcy5kYXRhc3RvcmUucHJvamVjdDtcbiAgICAgICAgICAgICAgICB2YWx1ZS5saW5rcy5mb3JFYWNoKHBhcmFtcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFzdG9yZSA9IHByb2plY3QuZGF0YXN0b3JlU3luYyhwYXJhbXMuZF9pZCk7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5pdGVtcy5mb3JFYWNoKGl0ZW1QYXJhbXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlua2VkSXRlbSA9IEl0ZW0uZnJvbUpzb24oeyBkYXRhc3RvcmUsIGlfaWQ6IGl0ZW1QYXJhbXMuaV9pZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpbmtJdGVtcy5wdXNoKG5ldyBsaW5rSXRlbV8xLmRlZmF1bHQoeyBpdGVtOiB0aGlzLCBsaW5rZWRJdGVtLCBzYXZlZDogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAncGlubmVkJzpcbiAgICAgICAgICAgICAgICB0aGlzLnBpbm5lZCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYV9pZCc6XG4gICAgICAgICAgICBjYXNlICdwX2lkJzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZWRfYXQnOlxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlZEF0ID0gbmV3IERhdGUodmFsdWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndXBkYXRlZF9hdCc6XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVkQXQgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyZXZfbm8nOlxuICAgICAgICAgICAgICAgIHRoaXMucmV2Tm8gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3VucmVhZCc6XG4gICAgICAgICAgICAgICAgdGhpcy51bnJlYWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3dfaWQnOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaV9pZCc6XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzZWVkX2lfaWQnOlxuICAgICAgICAgICAgICAgIHRoaXMuc2VlZEl0ZW1JZCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnU3RhdHVzJzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0xhYmVsID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzdGF0dXNfaWQnOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzSWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RpdGxlJzpcbiAgICAgICAgICAgICAgICB0aGlzLnRpdGxlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjcmVhdGVkX2J5JzpcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZWRCeSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndXBkYXRlZF9ieSc6XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVkQnkgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xvb2t1cF9pdGVtcyc6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdpdGVtX2FjdGlvbnMnOlxuICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9ucyA9IE9iamVjdC5rZXlzKHZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAubWFwKChkaXNwbGF5X2lkKSA9PiBpdGVtQWN0aW9uXzEuZGVmYXVsdFxuICAgICAgICAgICAgICAgICAgICAuZnJvbUpzb24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgZGlzcGxheV9pZCB9LCB2YWx1ZVtkaXNwbGF5X2lkXSksIHsgaXRlbTogdGhpcyB9KSkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3RhdHVzX2xpc3QnOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzZXMgPSBPYmplY3Qua2V5cyh2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoZGlzcGxheV9pZCkgPT4gaXRlbVN0YXR1c18xLmRlZmF1bHRcbiAgICAgICAgICAgICAgICAgICAgLmZyb21Kc29uKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IGRpc3BsYXlfaWQgfSwgdmFsdWVbZGlzcGxheV9pZF0pLCB7IGl0ZW06IHRoaXMgfSkpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3N0YXR1c19hY3Rpb25zJzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0FjdGlvbnMgPSBPYmplY3Qua2V5cyh2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoZGlzcGxheV9pZCkgPT4gc3RhdHVzQWN0aW9uXzEuZGVmYXVsdFxuICAgICAgICAgICAgICAgICAgICAuZnJvbUpzb24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgZGlzcGxheV9pZCB9LCB2YWx1ZVtkaXNwbGF5X2lkXSksIHsgaXRlbTogdGhpcyB9KSkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3RhdHVzX29yZGVyJzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c09yZGVyID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzdGF0dXNfYWN0aW9uX29yZGVyJzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0FjdGlvbk9yZGVyID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdpdGVtX2FjdGlvbl9vcmRlcic6XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtQWN0aW9uT3JkZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ZpZWxkX3ZhbHVlcyc6XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXModmFsdWUpLmZvckVhY2goZmllbGROYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gdmFsdWVbZmllbGROYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbC5kYXRhVHlwZSA9PT0gZmllbGRfMS5EYXRhVHlwZS5EU0xPT0tVUCAmJiB2YWwudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFzdG9yZSA9IHRoaXMuZGF0YXN0b3JlLnByb2plY3QuZGF0YXN0b3JlU3luYyh2YWwudmFsdWUuZF9pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB2YWwudmFsdWUubG9va3VwX2l0ZW07XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMuZGF0YXN0b3JlID0gZGF0YXN0b3JlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IEl0ZW0uZnJvbUpzb24ocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzW2ZpZWxkTmFtZV0gPSBpdGVtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRGaWVsZFZhbHVlKGZpZWxkTmFtZSwgdmFsLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZpZWxkVmFsdWUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGFkZChmaWVsZE5hbWUsIHZhbHVlKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZEFsbChmaWVsZE5hbWUsIHZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlRmllbGRVcGRhdGUpXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmRhdGFzdG9yZS5maWVsZFN5bmMoZmllbGROYW1lKTtcbiAgICAgICAgaWYgKCFmaWVsZC52YWxpZCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCB2YWx1ZSAke3ZhbHVlfSBmb3IgZmllbGQga2V5ICR7ZmllbGQubmFtZX1gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5maWVsZHNbZmllbGROYW1lXSkge1xuICAgICAgICAgICAgdGhpcy5maWVsZHNbZmllbGROYW1lXS5wdXNoKGZpZWxkLnZhbHVlKHZhbHVlLCB7IGl0ZW06IHRoaXMgfSlbMF0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5maWVsZHNbZmllbGROYW1lXSA9IFtmaWVsZC52YWx1ZSh2YWx1ZSwgeyBpdGVtOiB0aGlzIH0pXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYWRkQWxsKGZpZWxkTmFtZSwgdmFsdWVzKSB7XG4gICAgICAgIHZhbHVlcy5mb3JFYWNoKHZhbHVlID0+IHRoaXMuYWRkKGZpZWxkTmFtZSwgdmFsdWUpKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHNldEZpZWxkVmFsdWUoZmllbGROYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5pZ25vcmVGaWVsZFVwZGF0ZSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICBjb25zdCBmaWVsZCA9IHRoaXMuZGF0YXN0b3JlLmZpZWxkU3luYyhmaWVsZE5hbWUpO1xuICAgICAgICBpZiAoIWZpZWxkLnZhbGlkKHZhbHVlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHZhbHVlICR7dmFsdWV9IGZvciBmaWVsZCBrZXkgJHtmaWVsZC5uYW1lfWApO1xuICAgICAgICB9XG4gICAgICAgIHZhbHVlID0gZmllbGQudmFsdWUodmFsdWUsIHsgaXRlbTogdGhpcyB9KTtcbiAgICAgICAgaWYgKGZpZWxkLmRhdGFUeXBlLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICdzdGF0dXMnKSB7XG4gICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpZWxkc1tmaWVsZC5kaXNwbGF5SWRdID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBnZXQobmFtZSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5maWVsZHNbbmFtZV0gJiYgdGhpcy5maWVsZHNbbmFtZV0uZmllbGQgPyB0aGlzLmZpZWxkc1tuYW1lXS52YWx1ZSA6IHRoaXMuZmllbGRzW25hbWVdO1xuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCAmJiBkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF2YWx1ZSlcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgc3RhdGljIGFsbChwYXJhbXMsIGRhdGFzdG9yZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBnZXRJdGVtc1BhcmFtZXRlcnM6IHBhcmFtcyxcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJZDogZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIHByb2plY3RJZDogZGF0YXN0b3JlLnByb2plY3QuaWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcGF5bG9hZC5nZXRJdGVtc1BhcmFtZXRlcnMucmV0dXJuX251bWJlcl92YWx1ZSA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLmdldEl0ZW1zUGFyYW1ldGVycy5pbmNsdWRlX2xpbmtzID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQuZ2V0SXRlbXNQYXJhbWV0ZXJzLmZvcm1hdCA9ICdtYXAnO1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgSXRlbS5yZXF1ZXN0KGl0ZW1fMS5EU19JVEVNUywgcGF5bG9hZCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmVzLmRhdGFzdG9yZUdldERhdGFzdG9yZUl0ZW1zLml0ZW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLml0ZW1fbGlua3MgfHwgIWl0ZW0uaXRlbV9saW5rcy5saW5rcyB8fCBpdGVtLml0ZW1fbGlua3MubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmsgb2YgaXRlbS5pdGVtX2xpbmtzLmxpbmtzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbGluay5kX2lkKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSB5aWVsZCBkYXRhc3RvcmUucHJvamVjdC5kYXRhc3RvcmUobGluay5kX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgZC5maWVsZHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IHJlcy5kYXRhc3RvcmVHZXREYXRhc3RvcmVJdGVtcy5pdGVtc1xuICAgICAgICAgICAgICAgIC5tYXAoKHBhcmFtcykgPT4gSXRlbS5mcm9tSnNvbihPYmplY3QuYXNzaWduKHsgZGF0YXN0b3JlIH0sIHBhcmFtcykpKTtcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsQ291bnQgPSByZXMuZGF0YXN0b3JlR2V0RGF0YXN0b3JlSXRlbXMudG90YWxJdGVtcztcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG90YWxDb3VudCwgaXRlbXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgc3RhdGljIHNlYXJjaChwYXlsb2FkLCBkYXRhc3RvcmUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGF5bG9hZC5wYWdlID09PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnBhZ2UgPSAxO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXlsb2FkLnBlcl9wYWdlID09PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnBlcl9wYWdlID0gMTAwO1xuICAgICAgICAgICAgcGF5bG9hZC5pbmNsdWRlX2xvb2t1cHMgPSB0cnVlO1xuICAgICAgICAgICAgcGF5bG9hZC5pbmNsdWRlX2xpbmtzID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQucmV0dXJuX251bWJlcl92YWx1ZSA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLmluY2x1ZGVfZmllbGRzX2RhdGEgPSB0cnVlO1xuICAgICAgICAgICAgcGF5bG9hZC5mb3JtYXQgPSAnbWFwJztcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHlpZWxkIHRoaXMucmVxdWVzdChpdGVtXzEuSVRFTV9XSVRIX1NFQVJDSCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5pdGVtV2l0aFNlYXJjaC5pdGVtcy5tYXAoKHBhcmFtcykgPT4gSXRlbS5mcm9tSnNvbihPYmplY3QuYXNzaWduKHsgZGF0YXN0b3JlIH0sIHBhcmFtcykpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBzZWFyY2hXaXRoQ291bnQocGF5bG9hZCwgZGF0YXN0b3JlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBheWxvYWQucGFnZSA9PT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgcGF5bG9hZC5wYWdlID0gMTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGF5bG9hZC5wZXJfcGFnZSA9PT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgcGF5bG9hZC5wZXJfcGFnZSA9IDEwMDtcbiAgICAgICAgICAgIHBheWxvYWQuaW5jbHVkZV9sb29rdXBzID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQuaW5jbHVkZV9saW5rcyA9IHRydWU7XG4gICAgICAgICAgICBwYXlsb2FkLnJldHVybl9udW1iZXJfdmFsdWUgPSB0cnVlO1xuICAgICAgICAgICAgcGF5bG9hZC5pbmNsdWRlX2ZpZWxkc19kYXRhID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQuZm9ybWF0ID0gJ21hcCc7XG4gICAgICAgICAgICBwYXlsb2FkLnVzZV9kaXNwbGF5X2lkID0gdHJ1ZTtcbiAgICAgICAgICAgIHBheWxvYWQuZGF0YXN0b3JlX2lkID0gZGF0YXN0b3JlLmlkO1xuICAgICAgICAgICAgcGF5bG9hZC5wcm9qZWN0X2lkID0gZGF0YXN0b3JlLnByb2plY3QuaWQ7XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLklURU1fV0lUSF9TRUFSQ0gsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gcmVzLml0ZW1XaXRoU2VhcmNoLml0ZW1zLm1hcCgocGFyYW1zKSA9PiBJdGVtLmZyb21Kc29uKE9iamVjdC5hc3NpZ24oeyBkYXRhc3RvcmUgfSwgcGFyYW1zKSkpO1xuICAgICAgICAgICAgY29uc3QgdG90YWxDb3VudCA9IHJlcy5pdGVtV2l0aFNlYXJjaC50b3RhbEl0ZW1zO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0b3RhbENvdW50LCBpdGVtcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlYXRlSXRlbUlkKGRhdGFzdG9yZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5DUkVBVEVfSVRFTUlELCB7IGRhdGFzdG9yZUlkOiBkYXRhc3RvcmUuaWQgfSk7XG4gICAgICAgICAgICByZXR1cm4gcmVzLmRhdGFzdG9yZUNyZWF0ZUl0ZW1JRC5pdGVtX2lkO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgc3RhdGljIGRlbGV0ZShjb25kaXRpb25zLCBkYXRhc3N0b3JlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgcHJvamVjdElkOiBkYXRhc3N0b3JlLnByb2plY3QuaWQsXG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSWQ6IGRhdGFzc3RvcmUuaWQsXG4gICAgICAgICAgICAgICAgZGVsZXRlSXRlbXNQYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZV9kaXNwbGF5X2lkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLkRFTEVURV9JVEVNUywgcGFyYW1zKTtcbiAgICAgICAgICAgIHJldHVybiByZXMuZGF0YXN0b3JlRGVsZXRlRGF0YXN0b3JlSXRlbXMuc3VjY2VzcztcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNhdmUoY29tbWVudCwgYWN0aW9uTmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgeWllbGQgKCF0aGlzLmlkID8gdGhpcy5jcmVhdGUoYWN0aW9uTmFtZSkgOiB0aGlzLnVwZGF0ZShjb21tZW50LCBhY3Rpb25OYW1lKSk7XG4gICAgICAgICAgICB5aWVsZCB0aGlzLmZldGNoKCk7XG4gICAgICAgICAgICB5aWVsZCBQcm9taXNlLmFsbCh0aGlzLl9saW5rSXRlbXMubWFwKGxpbmtJdGVtID0+IGxpbmtJdGVtLmNyZWF0ZSgpKSk7XG4gICAgICAgICAgICB5aWVsZCBQcm9taXNlLmFsbCh0aGlzLl91bmxpbmtJdGVtcy5tYXAobGlua0l0ZW0gPT4gbGlua0l0ZW0uZGVsZXRlKCkpKTtcbiAgICAgICAgICAgIHRoaXMuX2xpbmtJdGVtcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fdW5saW5rSXRlbXMgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgbGluayhpdGVtKSB7XG4gICAgICAgIHRoaXMuX2xpbmtJdGVtcy5wdXNoKG5ldyBsaW5rSXRlbV8xLmRlZmF1bHQoeyBpdGVtOiB0aGlzLCBsaW5rZWRJdGVtOiBpdGVtIH0pKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHVubGluayhpdGVtKSB7XG4gICAgICAgIHRoaXMuX3VubGlua0l0ZW1zLnB1c2gobmV3IGxpbmtJdGVtXzEuZGVmYXVsdCh7IGl0ZW06IHRoaXMsIGxpbmtlZEl0ZW06IGl0ZW0gfSkpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgY3JlYXRlKGFjdGlvbk5hbWUgPSAnQ3JlYXRlSXRlbScpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5kYXRhc3RvcmUpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhc3RvcmUgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IHlpZWxkIHRoaXMuYWN0aW9uT3JTdGF0dXNBY3Rpb24oYWN0aW9uTmFtZSk7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIGFjdGlvbl9pZDogYWN0aW9uICYmIGFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICByZXR1cm5faXRlbV9yZXN1bHQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaXNfbm90aWZ5X3RvX3NlbmRlcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbnN1cmVfdHJhbnNhY3Rpb246IGZhbHNlLFxuICAgICAgICAgICAgICAgIGV4ZWNfY2hpbGRyZW5fcG9zdF9wcm9jczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpdGVtOiB5aWVsZCB0aGlzLnRvSnNvbigpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHlpZWxkIHRoaXMucmVxdWVzdChpdGVtXzEuQ1JFQVRFX05FV19JVEVNLCB7XG4gICAgICAgICAgICAgICAgcHJvamVjdElkOiB0aGlzLmRhdGFzdG9yZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgICAgIGRhdGFzdG9yZUlkOiB0aGlzLmRhdGFzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICBwYXlsb2FkLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5kYXRhc3RvcmUuX2ZpZWxkcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy5kYXRhc3RvcmUuZmllbGRzKCk7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7fTtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHJlcy5kYXRhc3RvcmVDcmVhdGVOZXdJdGVtLml0ZW0pLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmRhdGFzdG9yZS5fZmllbGRzLmZpbmQoKGYpID0+IGYuaWQgPT09IGlkIHx8IGYuZGlzcGxheUlkID09PSBpZCk7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWVsZCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbaWRdID0gcmVzLmRhdGFzdG9yZUNyZWF0ZU5ld0l0ZW0uaXRlbVtpZF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbZmllbGQuZGlzcGxheUlkXSA9IHJlcy5kYXRhc3RvcmVDcmVhdGVOZXdJdGVtLml0ZW1baWRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwYXJhbXNba2V5XS5kX2lkKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhc3RvcmUgPSB0aGlzLmRhdGFzdG9yZS5wcm9qZWN0LmRhdGFzdG9yZVN5bmMocGFyYW1zW2tleV0uZF9pZCk7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGFzdG9yZSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNba2V5XSA9IHlpZWxkIGRhdGFzdG9yZS5pdGVtKHBhcmFtc1trZXldLml0ZW1faWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0cyhwYXJhbXMpO1xuICAgICAgICAgICAgdGhpcy5fc2V0U3RhdHVzKHRoaXMuX3N0YXR1cyk7XG4gICAgICAgICAgICBpZiAodGhpcy5fZXhpc3RBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9leGlzdEF0dGFjaG1lbnQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZXhlY3V0ZShhY3Rpb25OYW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3Rpb24gPSB5aWVsZCB0aGlzLmFjdGlvbk9yU3RhdHVzQWN0aW9uKGFjdGlvbk5hbWUpO1xuICAgICAgICAgICAgaWYgKCFhY3Rpb24pXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBY3Rpb24gJHthY3Rpb25OYW1lfSBub3QgZm91bmRgKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICByZXZfbm86IHRoaXMucmV2Tm8sXG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlX2lkOiB0aGlzLmRhdGFzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICBhY3Rpb25faWQ6IGFjdGlvbiAmJiBhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgaXNfbm90aWZ5X3RvX3NlbmRlcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbnN1cmVfdHJhbnNhY3Rpb246IHRydWUsXG4gICAgICAgICAgICAgICAgZXhlY19jaGlsZHJlbl9wb3N0X3Byb2NzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJldHVybl9pdGVtX3Jlc3VsdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpdGVtOiB5aWVsZCB0aGlzLnRvSnNvbigpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHlpZWxkIHRoaXMucmVxdWVzdChpdGVtXzEuRVhFQ1VURV9JVEVNX0FDVElPTiwge1xuICAgICAgICAgICAgICAgIGFjdGlvbklkOiBhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIGl0ZW1JZDogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICBwcm9qZWN0SWQ6IHRoaXMuZGF0YXN0b3JlLnByb2plY3QuaWQsXG4gICAgICAgICAgICAgICAgaXRlbUFjdGlvblBhcmFtZXRlcnM6IHBhcmFtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnNldHMocmVzLmRhdGFzdG9yZUV4ZWN1dGVJdGVtQWN0aW9uLml0ZW0pO1xuICAgICAgICAgICAgdGhpcy5fc2V0U3RhdHVzKHRoaXMuX3N0YXR1cyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFjdGlvbk9yU3RhdHVzQWN0aW9uKGFjdGlvbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IHlpZWxkIHRoaXMuYWN0aW9uKGFjdGlvbk5hbWUpO1xuICAgICAgICAgICAgaWYgKGFjdGlvbilcbiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uO1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzQWN0aW9uID0gdGhpcy5zdGF0dXNBY3Rpb25zLmZpbmQoYSA9PiBhLmRpc3BsYXlJZCA9PT0gYWN0aW9uTmFtZSB8fCBhLmlkID09PSBhY3Rpb25OYW1lIHx8IGEubmFtZSA9PT0gYWN0aW9uTmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gc3RhdHVzQWN0aW9uO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgdXBkYXRlKGNvbW1lbnQsIGFjdGlvbk5hbWUgPSAnVXBkYXRlSXRlbScpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IHlpZWxkIHRoaXMuYWN0aW9uT3JTdGF0dXNBY3Rpb24oYWN0aW9uTmFtZSk7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgcmV2X25vOiB0aGlzLnJldk5vLFxuICAgICAgICAgICAgICAgIGRhdGFzdG9yZV9pZDogdGhpcy5kYXRhc3RvcmUuaWQsXG4gICAgICAgICAgICAgICAgYWN0aW9uX2lkOiBhY3Rpb24gJiYgYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgIGlzX25vdGlmeV90b19zZW5kZXI6IHRydWUsXG4gICAgICAgICAgICAgICAgZW5zdXJlX3RyYW5zYWN0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGV4ZWNfY2hpbGRyZW5fcG9zdF9wcm9jczogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZXR1cm5faXRlbV9yZXN1bHQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaXRlbTogeWllbGQgdGhpcy50b0pzb24oKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoY29tbWVudCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5oaXN0b3J5ID0ge1xuICAgICAgICAgICAgICAgICAgICBjb21tZW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhc3RvcmVfaWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLkRBVEFTVE9SRV9VUERBVEVfSVRFTSwge1xuICAgICAgICAgICAgICAgIGRhdGFzdG9yZUlkOiB0aGlzLmRhdGFzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICBpdGVtSWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgcHJvamVjdElkOiB0aGlzLmRhdGFzdG9yZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgICAgIGl0ZW1BY3Rpb25QYXJhbWV0ZXJzOiBwYXJhbXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zZXRzKHJlcy5kYXRhc3RvcmVVcGRhdGVJdGVtLml0ZW0pO1xuICAgICAgICAgICAgdGhpcy5fc2V0U3RhdHVzKHRoaXMuX3N0YXR1cyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHRvSnNvbigpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGpzb24gPSB7fTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuZmllbGRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmRhdGFzdG9yZS5maWVsZFN5bmMoa2V5KTtcbiAgICAgICAgICAgICAgICBpZiAoIWZpZWxkKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpZWxkICR7a2V5fSBpcyBub3QgZm91bmRgKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaWQgJiYgZmllbGQuZGF0YVR5cGUgPT09IGZpZWxkXzEuRGF0YVR5cGUuRklMRSAmJiB0aGlzLmZpZWxkc1trZXldICYmIHRoaXMuZmllbGRzW2tleV0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuZmllbGRzW2tleV07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBmaWxlcy5maW5kKGYgPT4gIWYuaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXhpc3RBdHRhY2htZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0geWllbGQgZmllbGQuY29udmVydCh0aGlzLmZpZWxkc1trZXldKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB0aGlzLmZpZWxkc1trZXldKSB7XG4gICAgICAgICAgICAgICAgICAgIGpzb25ba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBqc29uO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgc3RhdHVzKHN0YXR1cykge1xuICAgICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgICAgICBjb25zdCBzdGF0dXNBY3Rpb24gPSB0aGlzLnN0YXR1c0FjdGlvbnMuZmluZChhY3Rpb24gPT4gYWN0aW9uLmRpc3BsYXlJZCA9PT0gc3RhdHVzKTtcbiAgICAgICAgICAgIGlmICghc3RhdHVzQWN0aW9uKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU3RhdHVzIGFjdGlvbiBpcyBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXR1c0FjdGlvbiA9IHN0YXR1c0FjdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IG5ld1N0YXR1cyA9IHRoaXMuc3RhdHVzZXMuZmluZChzID0+IHMuaWQgPT09IHN0YXR1c0FjdGlvbi5uZXh0U3RhdHVzSWQpO1xuICAgICAgICAgICAgaWYgKCFuZXdTdGF0dXMpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTdGF0dXMgaXMgbm90IGZvdW5kICR7c3RhdHVzQWN0aW9uLm5leHRTdGF0dXNJZH1gKTtcbiAgICAgICAgICAgIHRoaXMuX3NldFN0YXR1cyhuZXdTdGF0dXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0dXMuZGlzcGxheUlkO1xuICAgIH1cbiAgICBmZXRjaCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJZDogdGhpcy5kYXRhc3RvcmUuaWQsXG4gICAgICAgICAgICAgICAgaXRlbUlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIHByb2plY3RJZDogdGhpcy5kYXRhc3RvcmUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJdGVtRGV0YWlsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVfbG9va3VwczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdXNlX2Rpc3BsYXlfaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJldHVybl9udW1iZXJfdmFsdWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdDogJ21hcCcsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVfbGlua2VkX2l0ZW1zOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgdGhpcy5yZXF1ZXN0KGl0ZW1fMS5JVEVNX0RFVEFJTCwgcGFyYW1zKTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIHJlcy5nZXREYXRhc3RvcmVJdGVtRGV0YWlscy5maWVsZF92YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IHJlcy5nZXREYXRhc3RvcmVJdGVtRGV0YWlscy5maWVsZF92YWx1ZXNba2V5XTtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQuZGF0YVR5cGUgIT09ICdkc2xvb2t1cCcgfHwgIWZpZWxkLnZhbHVlKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLmRhdGFzdG9yZS5wcm9qZWN0LmRhdGFzdG9yZShmaWVsZC52YWx1ZS5kX2lkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0cyhyZXMuZ2V0RGF0YXN0b3JlSXRlbURldGFpbHMpO1xuICAgICAgICAgICAgdGhpcy5fc2V0U3RhdHVzKHRoaXMuX3N0YXR1cyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGRlbGV0ZSgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IHlpZWxkIHRoaXMuYWN0aW9uKCdEZWxldGVJdGVtJyk7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgYV9pZDogYWN0aW9uLmlkLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHlpZWxkIHRoaXMucmVxdWVzdChpdGVtXzEuREVMRVRFX0lURU0sIHtcbiAgICAgICAgICAgICAgICBkYXRhc3RvcmVJZDogdGhpcy5kYXRhc3RvcmUuaWQsXG4gICAgICAgICAgICAgICAgaXRlbUlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIHByb2plY3RJZDogdGhpcy5kYXRhc3RvcmUucHJvamVjdC5pZCxcbiAgICAgICAgICAgICAgICBkZWxldGVJdGVtUmVxOiBwYXJhbXMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAhcmVzLmRhdGFzdG9yZURlbGV0ZUl0ZW0uZXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhY3Rpb24oYWN0aW9uTmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlnbm9yZUZpZWxkVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLmZldGNoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVGaWVsZFVwZGF0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9ucy5maW5kKGEgPT4gYS5kaXNwbGF5SWQudHJpbSgpLnRvTG93ZXJDYXNlKCkgPT09IGFjdGlvbk5hbWUudHJpbSgpLnRvTG9jYWxlTG93ZXJDYXNlKCkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29tbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBpdGVtSGlzdG9yeV8xLmRlZmF1bHQoeyBpdGVtOiB0aGlzIH0pO1xuICAgIH1cbiAgICBfc2V0U3RhdHVzKHN0YXR1cykge1xuICAgICAgICBpZiAodGhpcy5zdGF0dXNlcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh0eXBlb2Ygc3RhdHVzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzTmFtZSA9IE9iamVjdC5rZXlzKHRoaXMuZmllbGRzKS5maW5kKGZpZWxkTmFtZSA9PiB0aGlzLmRhdGFzdG9yZS5maWVsZFN5bmMoZmllbGROYW1lKS5kYXRhVHlwZSA9PT0gJ3N0YXR1cycpO1xuICAgICAgICAgICAgaWYgKHN0YXR1c05hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSB0aGlzLnN0YXR1c2VzLmZpbmQoc3RhdHVzID0+IHN0YXR1cy5pZCA9PT0gdGhpcy5maWVsZHNbc3RhdHVzTmFtZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuZmllbGRzW3N0YXR1c05hbWVdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhpc3RvcmllcyhnZXRIaXN0b3J5UGFyYW1RdWVyaWVzKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLmhpc3Rvcmllc1dpdGhVbnJlYWQoKTtcbiAgICAgICAgICAgIHJldHVybiByZXMuaGlzdG9yaWVzO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGlzdG9yaWVzV2l0aFVucmVhZChnZXRIaXN0b3J5UGFyYW1RdWVyaWVzKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgcHJvamVjdElkOiB0aGlzLmRhdGFzdG9yZS5wcm9qZWN0LmlkLFxuICAgICAgICAgICAgICAgIGRhdGFzdG9yZUlkOiB0aGlzLmRhdGFzdG9yZS5pZCxcbiAgICAgICAgICAgICAgICBpdGVtSWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgZ2V0SGlzdG9yeVBhcmFtUXVlcmllcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLklURU1fSElTVE9SSUVTLCBwYXJhbXMpO1xuICAgICAgICAgICAgY29uc3QgaGlzdG9yaWVzID0gcmVzLmdldEhpc3Rvcmllcy5oaXN0b3JpZXNcbiAgICAgICAgICAgICAgICAubWFwKChoaXN0b3J5KSA9PiBpdGVtSGlzdG9yeV8xLmRlZmF1bHQuZnJvbUpzb24oT2JqZWN0LmFzc2lnbih7IGl0ZW06IHRoaXMgfSwgaGlzdG9yeSkpKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdW5yZWFkOiByZXMuZ2V0SGlzdG9yaWVzLnVucmVhZCxcbiAgICAgICAgICAgICAgICBoaXN0b3JpZXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgbGlua3MobGlua2VkRGF0YXN0b3JlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSB5aWVsZCB0aGlzLnJlcXVlc3QoaXRlbV8xLklURU1fTElOS0VELCB7XG4gICAgICAgICAgICAgICAgZGF0YXN0b3JlSWQ6IHRoaXMuZGF0YXN0b3JlLmlkLFxuICAgICAgICAgICAgICAgIGl0ZW1JZDogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICBsaW5rZWREYXRhc3RvcmVJZDogdHlwZW9mIGxpbmtlZERhdGFzdG9yZSA9PT0gJ3N0cmluZycgPyBsaW5rZWREYXRhc3RvcmUgOiBsaW5rZWREYXRhc3RvcmUuaWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChyZXMuZGF0YXN0b3JlR2V0TGlua2VkSXRlbXMuaXRlbXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3RzID0geWllbGQgSXRlbS5jbGllbnQuY3VycmVudFdvcmtzcGFjZS5wcm9qZWN0cygpO1xuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcGFyYW1zIG9mIHJlcy5kYXRhc3RvcmVHZXRMaW5rZWRJdGVtcy5pdGVtcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3QgPSBwcm9qZWN0cy5maW5kKHAgPT4gcC5pZCA9PT0gcGFyYW1zLnBfaWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFzdG9yZSA9IHR5cGVvZiBsaW5rZWREYXRhc3RvcmUgPT09ICdzdHJpbmcnID8geWllbGQgcHJvamVjdC5kYXRhc3RvcmUocGFyYW1zLmRfaWQpIDogbGlua2VkRGF0YXN0b3JlO1xuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goeWllbGQgZGF0YXN0b3JlLml0ZW0ocGFyYW1zLmlfaWQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHlpZWxkIFByb21pc2UuYWxsKGl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS5mZXRjaCgpKSk7XG4gICAgICAgICAgICByZXR1cm4gaXRlbXM7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmaWxlKCkge1xuICAgICAgICByZXR1cm4gbmV3IGZpbGVPYmplY3RfMS5kZWZhdWx0KHsgaXRlbTogdGhpcyB9KTtcbiAgICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSBJdGVtO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../../Code/Hexabase/hexabase-js/dist/lib/packages/item/index.js\n"));

/***/ })

});